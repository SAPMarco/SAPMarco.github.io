/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/f/GridContainerUtils","sap/ui/core/delegate/ItemNavigation","sap/ui/events/KeyCodes","sap/base/Log","sap/f/library"],function(o,e,t,i,r){"use strict";var n=r.NavigationDirection;var s=e.extend("sap.f.delegate.GridItemNavigation",{metadata:{library:"sap.f",properties:{},events:{}}});s.prototype.onfocusin=function(t){e.prototype.onfocusin.call(this,t);var i=jQuery(this.oDomRef).control(0),r=o.makeMatrix(i);if(t.target===this.oDomRef){this._mCurrentPosition=this._findPositionInMatrix(r,this.getItemDomRefs().indexOf(this.iFocusedIndex))}};s.prototype.onsapfocusleave=function(o){e.prototype.onsapfocusleave.call(this,o);this._mCurrentPosition=null};s.prototype.onsapnext=function(o){this._moveFocus(o)};s.prototype.onsapprevious=function(o){this._moveFocus(o)};s.prototype._moveFocus=function(e){var i=this.getItemDomRefs();if(i.indexOf(e.target)===-1){return}e.preventDefault();var r=e.target,n=e.srcControl,s=o.makeMatrix(n),u=this._findPositionInMatrix(s,r);if(!this._mCurrentPosition){this._mCurrentPosition={column:u.column,row:u.row}}switch(e.keyCode){case t.ARROW_DOWN:this._moveFocusDown(u,s,r,e);break;case t.ARROW_RIGHT:this._moveFocusRight(u,s,r,e);break;case t.ARROW_UP:this._moveFocusUp(u,s,r,e);break;case t.ARROW_LEFT:this._moveFocusLeft(u,s,r,e);break;default:break}};s.prototype._moveFocusDown=function(o,e,t,r){var n=this.getItemDomRefs(),s;o.column=this._mCurrentPosition.column;while(o.row<e.length&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.row+=1}if(o.row>=e.length){this._onBorderReached(r);return}i.info("Grid matrix position:"+o.row,o.column);s=e[o.row][o.column];if(s){this._mCurrentPosition=o;this.focusItem(n.indexOf(s),r)}else{this._onBorderReached(r)}};s.prototype._moveFocusRight=function(o,e,t,r){var n=this.getItemDomRefs(),s;o.row=this._mCurrentPosition.row;while(o.column<e[o.row].length&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.column+=1}if(o.column>=e[o.row].length){this._onBorderReached(r);return}i.info("Grid matrix position:"+o.row,o.column);s=e[o.row][o.column];if(s){this._mCurrentPosition=o;this.focusItem(n.indexOf(s),r)}else{this._onBorderReached(r)}};s.prototype._moveFocusUp=function(o,e,t,r){var n=this.getItemDomRefs(),s;o.column=this._mCurrentPosition.column;while(o.row>=0&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.row-=1}if(o.row<0){this._onBorderReached(r);return}i.info("Grid matrix position:"+o.row,o.column);s=e[o.row][o.column];if(s){while(o.row>0&&e[o.row-1][o.column]===s){o.row-=1}this._mCurrentPosition=o;this.focusItem(n.indexOf(s),r)}else{this._onBorderReached(r)}};s.prototype._moveFocusLeft=function(o,e,t,r){var n=this.getItemDomRefs(),s;o.row=this._mCurrentPosition.row;while(o.column>=0&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.column-=1}if(o.column<0){this._onBorderReached(r);return}i.info("Grid matrix position:"+o.row,o.column);s=e[o.row][o.column];if(s){while(o.column>0&&e[o.row][o.column-1]===s){o.column-=1}this._mCurrentPosition=o;this.focusItem(n.indexOf(s),r)}else{this._onBorderReached(r)}};s.prototype._findPositionInMatrix=function(o,e){var t=null;o.some(function(o,i){var r=o.indexOf(e);if(r!==-1){t={};t.row=i;t.column=r;return true}return false});return t};s.prototype._onBorderReached=function(o){var e=o.srcControl,i;switch(o.keyCode){case t.ARROW_RIGHT:i=n.Right;break;case t.ARROW_LEFT:i=n.Left;break;case t.ARROW_DOWN:i=n.Down;break;case t.ARROW_UP:i=n.Up;break}e.onItemNavigationBorderReached({event:o,row:this._mCurrentPosition.row,column:this._mCurrentPosition.column,direction:i})};s.prototype.focusItemByDirection=function(e,t,i,r){var s,u=o.makeMatrix(e),c,a,m;switch(t){case n.Right:a=i;m=-1;c=u[i];if(c){do{s=c[++m]}while(!s)}break;case n.Left:a=i;m=u[0].length;c=u[i];if(c){do{s=c[--m]}while(!s)}while(s&&m>0&&u[i][m-1]===s){m--}break;case n.Down:a=-1;m=r;do{s=u[++a][r]}while(!s);break;case n.Up:a=u.length;m=r;do{s=u[--a][r]}while(!s);while(s&&a>0&&u[a-1][r]===s){a--}break}if(!s){return}this._mCurrentPosition={column:m,row:a};s.focus()};return s});