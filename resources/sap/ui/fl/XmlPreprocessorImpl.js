/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Component","sap/ui/fl/FlexControllerFactory","sap/ui/fl/Utils","sap/ui/fl/ChangePersistenceFactory","sap/base/Log"],function(e,r,n,t,i){"use strict";var o=function(){};o.process=function(t,o){try{if(!o||o.sync){i.warning("Flexibility feature for applying changes on an XML view is only available for "+"asynchronous views; merge is be done later on the JS controls.");return t}o.viewId=o.id;var s=e.get(o.componentId);if(!s){i.warning("View is generated without a component. Flexibility features are not possible.");return Promise.resolve(t)}var a=n.getAppComponentForControl(s);if(!n.isApplication(a.getManifestObject())){return Promise.resolve(t)}var p=n.getComponentClassName(a);var l=n.getAppVersionFromManifest(a.getManifest());var c=r.create(p,l);return c.processXmlView(t,o).then(function(){i.debug("flex processing view "+o.id+" finished");return t}).catch(function(){i.warning("Error happens when getting flex cache key! flexibility XML view preprocessing is skipped. "+"The processing will be done later on the JS controls.");return Promise.resolve(t)})}catch(e){var g="view "+o.id+": "+e;i.info(g);return Promise.resolve(t)}};o.getCacheKey=function(r){var i=e.get(r.componentId);var o=n.getAppComponentForControl(i);if(n.isVariantByStartupParameter(o)){return Promise.resolve()}var s=n.getComponentClassName(o);var a=n.getAppVersionFromManifest(o.getManifest());var p=t.getChangePersistenceForComponent(s,a);return p.getCacheKey(o)};return o},true);