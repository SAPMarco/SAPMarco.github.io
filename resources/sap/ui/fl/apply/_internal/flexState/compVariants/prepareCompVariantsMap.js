/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Change","sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/ui/fl/apply/_internal/flexState/compVariants/CompVariantMerger"],function(a,n,e){"use strict";function t(a,n){a[n]=a[n]||{variants:[],nonPersistedVariants:[],changes:[],defaultVariant:undefined,standardVariant:undefined};return a[n]}function r(a,n,r,i){i=i||[];var s=t(a,r);s.nonPersistedVariants.forEach(function(a){delete n[a.getId()]});s.nonPersistedVariants=i.map(function(a){var t=Object.assign({id:a.id,persisted:false},a);t=e.createVariant(r,t);n[a.id]=t;return t});return s}function i(e,r,i,s){var d=r==="variants"?n:a;var u=e[r].map(function(n){var e=new d(n);e.setState(a.states.PERSISTED);return e});u.forEach(function(a){i[a.getId()]=a;var n=a.getSelector().persistencyKey;switch(r){case"defaultVariants":t(s,n)["defaultVariant"]=a;break;case"standardVariants":t(s,n)["standardVariant"]=a;break;default:t(s,n)[r].push(a)}})}return function(a){var n={};var e={};e._getOrCreate=t.bind(undefined,e);e._initialize=r.bind(undefined,e,n);if(a.storageResponse.changes.comp){["variants","changes","defaultVariants","standardVariants"].forEach(function(t){i(a.storageResponse.changes.comp,t,n,e)})}return{map:e,byId:n}}});