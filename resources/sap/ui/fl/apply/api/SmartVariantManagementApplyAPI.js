/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/DefaultVariant","sap/ui/fl/StandardVariant","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/registry/Settings","sap/ui/fl/Utils","sap/ui/fl/LayerUtils","sap/base/Log"],function(t,e,n,r,a,i,o,s){"use strict";var u={_PERSISTENCY_KEY:"persistencyKey",loadChanges:function(e){var n=e.control;var a=i.getAppDescriptor(n);var o=i.getSiteId(n);var s=this._getStableId(n);var u={appDescriptor:a,siteId:o,includeVariants:true};var g=r.getChangePersistenceForControl(n);return t.initialize({componentId:i.getAppComponentForControl(n).getId()}).then(function(){return g.getControlChangesForVariant(this._PERSISTENCY_KEY,s,u)}.bind(this))},getChangeById:function(t){var e=t.control;var n=t.id;if(!n||!e){s.error("sId or oControl is not defined");return undefined}var r=this._getChangeMap(e);return r[n]},isVariantSharingEnabled:function(){return a.getInstance().then(function(t){return t.isVariantSharingEnabled()})},isApplicationVariant:function(t){var e=t.control;if(i.isApplicationVariant(e)){return true}var n=i.getComponentForControl(e);if(n&&n.getAppComponent){n=n.getAppComponent();if(n){return true}}return false},isVendorLayer:function(){return o.isVendorLayer()},isVariantDownport:function(){return u.isVendorLayer()&&i.isHotfixMode()},getDefaultVariantId:function(t){var n=this._getChangeMap(t.control);return e.getDefaultVariantId(n)},getExecuteOnSelect:function(t){var e=this._getChangeMap(t.control);return n.getExecuteOnSelect(e)},_getStableId:function(t){if(!t){return undefined}var e;try{e=t.getPersistencyKey()}catch(t){e=""}return e},_getChangeMap:function(t){var e=r.getChangePersistenceForControl(t);var n=u._getStableId(t);return e.getSmartVariantManagementChangeMap()[n]||{}}};return u},true);