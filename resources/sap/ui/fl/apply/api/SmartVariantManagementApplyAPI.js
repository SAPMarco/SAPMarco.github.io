/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/Change","sap/ui/fl/registry/Settings","sap/ui/fl/Utils","sap/ui/fl/LayerUtils"],function(e,t,n,r,a,i,o){"use strict";function l(e){return e&&e.getPersistencyKey&&e.getPersistencyKey()}function u(n){var r=t.getFlexReferenceForControl(n);var a=l(n);var i=e.getCompVariantsMap(r);return i._getOrCreate(a)}var c={getCompEntities:function(n){var r=t.getFlexReferenceForControl(n.control);return e.initialize({reference:r,componentData:{},manifest:i.getAppDescriptor(n.control),componentId:i.getAppComponentForControl(n.control).getId()}).then(u.bind(undefined,n.control))},loadChanges:function(e){return c.getCompEntities(e).then(function(e){return e.variants.concat(e.changes)})},getEntityById:function(n){var r=t.getFlexReferenceForControl(n.control);return e.getCompEntitiesByIdMap(r)[n.id]},isVariantSharingEnabled:function(){return a.getInstance().then(function(e){return e.isVariantSharingEnabled()})},isApplicationVariant:function(e){var t=e.control;if(i.isApplicationVariant(t)){return true}var n=i.getComponentForControl(t);if(n&&n.getAppComponent){n=n.getAppComponent();if(n){return true}}return false},isVendorLayer:function(){return o.isVendorLayer()},isVariantDownport:function(){return c.isVendorLayer()&&i.isHotfixMode()},getDefaultVariantId:function(e){var t=u(e.control).defaultVariant;return t?t.getContent().defaultVariantName:""},getExecuteOnSelect:function(e){var t=u(e.control).standardVariant;return t?t.getContent().executeOnSelect:null},getChangeById:function(e){return c.getEntityById(e)},_getChangeMap:function(n){var r=t.getFlexReferenceForControl(n);var a=l(n);var i=e.getCompEntitiesByIdMap(r);var o={};Object.keys(i).forEach(function(e){if(i[e].getSelector&&i[e].getSelector().persistencyKey===a&&i[e].getFileType()==="change"){o[e]=i[e]}});return o}};return c},true);