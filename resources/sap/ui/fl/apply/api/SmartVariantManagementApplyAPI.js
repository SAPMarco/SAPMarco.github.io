/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/compVariants/CompVariantMerger","sap/ui/fl/apply/_internal/flexState/compVariants/Utils","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/Utils","sap/ui/fl/LayerUtils"],function(e,t,n,r,a,i){"use strict";function o(e){var a=r.getFlexReferenceForControl(e);var i=t.getPersistencyKey(e);var o=n.getCompVariantsMap(a);return o._getOrCreate(i)}function l(e,a){var i=r.getFlexReferenceForControl(e);var o=t.getPersistencyKey(e);var l=n.getCompVariantsMap(i);return l._initialize(o,a)}function c(e){var t=r.getFlexReferenceForControl(e.control);return n.initialize({reference:t,componentData:{},manifest:a.getAppDescriptor(e.control),componentId:a.getAppComponentForControl(e.control).getId()}).then(l.bind(undefined,e.control,e.variants))}var p={loadVariants:function(n){return c(n).then(function(r){var a=t.getPersistencyKey(n.control);return e.merge(a,r,n.standardVariant)})},getEntityById:function(e){var t=r.getFlexReferenceForControl(e.control);return n.getCompEntitiesByIdMap(t)[e.id]},isApplicationVariant:function(e){var t=e.control;if(a.isApplicationVariant(t)){return true}var n=a.getComponentForControl(t);if(n&&n.getAppComponent){n=n.getAppComponent();if(n){return true}}return false},isVendorLayer:function(){return i.isVendorLayer()},isVariantDownport:function(){return p.isVendorLayer()&&a.isHotfixMode()},getDefaultVariantId:function(e){var t=o(e.control).defaultVariant;return t?t.getContent().defaultVariantName:""},getExecuteOnSelect:function(e){var t=o(e.control).standardVariant;return t?t.getContent().executeOnSelect:null},getChangeById:function(e){return p.getEntityById(e)},_getChangeMap:function(e){var a=r.getFlexReferenceForControl(e);var i=t.getPersistencyKey(e);var o=n.getCompEntitiesByIdMap(a);var l={};Object.keys(o).forEach(function(e){if(o[e].getSelector&&o[e].getSelector().persistencyKey===i&&o[e].getFileType()==="change"){l[e]=o[e]}});return l}};return p},true);