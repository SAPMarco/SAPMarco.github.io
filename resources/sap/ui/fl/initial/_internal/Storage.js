/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/initial/_internal/StorageUtils","sap/ui/fl/Utils","sap/ui/fl/LayerUtils","sap/ui/fl/initial/_internal/StorageResultMerger","sap/ui/fl/initial/_internal/storageResultDisassemble"],function(e,t,r,n,a){"use strict";function i(e,t,r){if(t.layers&&(t.layers[0]==="ALL"||t.layers.indexOf(r)!==-1)){e.draftLayer=r}else{delete e.draftLayer}return e}function l(n,a){var l=a.map(function(a){var l=Object.assign({},n,{url:a.url,path:a.path});var o=n.draftLayer||t.getUrlParameter(r.FL_VERSION_PARAM)||"";l=i(l,a,o);return a.loadConnectorModule.loadFlexData(l).then(function(t){return t||e.getEmptyFlexDataResponse()}).catch(e.logAndResolveDefault.bind(undefined,e.getEmptyFlexDataResponse(),a,"loadFlexData"))});return Promise.all(l)}function o(e){var t=[];e.forEach(function(e){if(Array.isArray(e)){t=t.concat(e)}else{t.push(e)}});return t}function u(e){return e.map(function(e){return a(e)})}function s(e){return Promise.resolve(e).then(o).then(u).then(o).then(n.merge)}function f(t){return e.getStaticFileConnector().then(l.bind(this,t))}var c={};c.completeFlexData=function(e){if(!e||!e.reference){return Promise.reject("No reference was provided")}return Promise.all([f(e),e.partialFlexData]).then(s)};c.loadFlexData=function(t){if(!t||!t.reference){return Promise.reject("No reference was provided")}return e.getLoadConnectors().then(l.bind(this,t)).then(s)};return c},true);