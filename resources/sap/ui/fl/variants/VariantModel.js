/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/base/util/each","sap/base/util/includes","sap/base/util/isEmptyObject","sap/base/util/merge","sap/base/util/ObjectPath","sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/core/BusyIndicator","sap/ui/fl/apply/_internal/changes/Reverter","sap/ui/fl/apply/_internal/controlVariants/URLHandler","sap/ui/fl/apply/_internal/flexState/controlVariants/Switcher","sap/ui/fl/apply/_internal/flexState/controlVariants/VariantManagementState","sap/ui/fl/apply/_internal/controlVariants/Utils","sap/ui/fl/changeHandler/Base","sap/ui/fl/Change","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/Utils","sap/ui/model/json/JSONModel"],function(e,t,a,n,r,i,o,s,c,l,f,u,h,p,g,v,d,m,V,C){"use strict";function R(e,t){return b(function(e,t){var a=t.model;var n=t.vmReference;var r=false;var o=e.key;var s=e.key;return Promise.resolve().then(function(){if(i.get([n,"currentVariant"],a.oData)&&a.oData[n].currentVariant!==a.oData[n].originalCurrentVariant){s=a.oData[n].originalCurrentVariant;r=true;return a.updateCurrentVariant(n,o,a.oAppComponent,true)}}).then(function(){if(i.get([n,"modified"],a.oData)===true){var e=h.getControlChangesForVariant({reference:a.sFlexReference,vmReference:n,vReference:s,changeInstance:true});return y({changes:e,vmReference:n,vReference:s,revert:!r,model:a}).then(function(){a.oData[n].originalCurrentVariant=o;a.oData[n].modified=false;a.checkUpdate(true)})}}).then(function(){if(!r){a._callVariantSwitchListeners(n,a.oData[n].currentVariant)}})}.bind(null,e.getParameters(),t),t.model,t.vmReference)}function y(e){var t=e.model._getDirtyChangesFromVariantChanges(e.changes);return Promise.resolve().then(function(){if(e.revert){return l.revertMultipleChanges(t,{appComponent:e.model.oAppComponent,modifier:s,flexController:e.model.oFlexController})}}).then(function(){t.forEach(function(t){h.removeChangeFromVariant({reference:e.model.sFlexReference,change:t,vmReference:e.vmReference,vReference:e.vReference});e.model.oFlexController.deleteChange(t,e.model.oAppComponent)})})}function D(e,t,a){if(a||e.oData[t]){e.oData[t].variantBusy=a}e.checkUpdate()}function b(e,t,a){t._oVariantSwitchPromise=t._oVariantSwitchPromise.catch(function(){}).then(D.bind(null,t,a,true)).then(e).then(D.bind(null,t,a,false)).catch(function(e){D(t,a,false);throw e});t.oFlexController.setVariantSwitchPromise(t._oVariantSwitchPromise);return t._oVariantSwitchPromise}function x(e){return u.switchVariant(e).then(function(){delete this.oData[e.vmReference]}.bind(this)).catch(function(e){o.warning(e.message)})}function F(e){return u.switchVariant(e).then(function(){this.oData[e.vmReference].originalCurrentVariant=e.newVReference;this.oData[e.vmReference].currentVariant=e.newVReference;if(this.oData[e.vmReference].updateVariantInURL){f.updateVariantInURL({vmReference:e.vmReference,newVReference:e.newVReference,model:this})}this._callVariantSwitchListeners(e.vmReference,e.newVReference);this.checkUpdate()}.bind(this))}function M(e,t,a){if(e.layer===m.getCurrentLayer(!a)&&e.key!==t){return true}return false}function S(e){return new Promise(function(t){if(e.getDomRef()){t()}else{e.addEventDelegate({onAfterRendering:function(){t()}})}})}var _=C.extend("sap.ui.fl.variants.VariantModel",{constructor:function(e,t,a,r){this.pSequentialImportCompleted=Promise.resolve();C.apply(this,arguments);this.bObserve=r;if(!t){t=sap.ui.requireSync("sap/ui/fl/FlexControllerFactory").createForControl(a)}this.oFlexController=t;this.oChangePersistence=this.oFlexController._oChangePersistence;this.sFlexReference=this.oChangePersistence.getComponentName();this.oAppComponent=a;this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.fl");this._oVariantSwitchPromise=Promise.resolve();this._oVariantAppliedListeners={};if(n(e)){try{e=h.fillVariantModel({reference:this.sFlexReference})}catch(e){o.error("Variants Map was not found: "+e.message)}}if(e&&typeof e==="object"){Object.keys(e).forEach(function(t){e[t].variants.forEach(function(a){if(!e[t].currentVariant&&a.key===e[t].defaultVariant){e[t].currentVariant=a.key}a.originalTitle=a.title;a.originalFavorite=a.favorite;a.originalExecuteOnSelect=a.executeOnSelect;a.originalVisible=a.visible});e[t].originalCurrentVariant=e[t].currentVariant;e[t].originalDefaultVariant=e[t].defaultVariant});this.setData(e)}f.initialize({model:this})}});_.prototype.updateCurrentVariant=function(e,t,a,n){var r={vmReference:e,currentVReference:this.oData[e].originalCurrentVariant,newVReference:t,flexController:this.oFlexController,appComponent:a||this.oAppComponent,modifier:s,reference:this.sFlexReference};if(n){return F.call(this,r)}return b(F.bind(this,r),this,e)};_.prototype.getCurrentVariantReference=function(e){return this.oData[e].currentVariant};_.prototype.getVariantManagementReference=function(e){var t="";var a=-1;Object.keys(this.oData).some(function(n){return this.oData[n].variants.some(function(r,i){if(r.key===e){t=n;a=i;return true}})}.bind(this));return{variantManagementReference:t,variantIndex:a}};_.prototype.getVariant=function(e,t){return h.getVariant({reference:this.sFlexReference,vmReference:t||this.getVariantManagementReference(e).variantManagementReference,vReference:e})};_.prototype.getVariantProperty=function(e,t){return this.getVariant(e).content.content[t]};function T(e){var t=h.getVariantChangesForVariant({vmReference:e,reference:this.sFlexReference});var a=this.oData[e].currentVariant;var n=this.oData[e].defaultVariant;if(this.oData[e]._executeOnSelectionForStandardDefault&&a===n&&a===e&&!t.setExecuteOnSelect){var r=h.getVariant({reference:this.sFlexReference,vmReference:e,vReference:e});r.content.content.executeOnSelect=true;this.oData[e].variants[0].originalExecuteOnSelect=true;this.oData[e].variants[0].executeOnSelect=true;return true}}_.prototype.attachVariantApplied=function(e){var t=this.getVariantManagementReferenceForControl(sap.ui.getCore().byId(e.vmControlId));return this.waitForVMControlInit(t).then(function(e,t){if(!this._oVariantAppliedListeners[e]){this._oVariantAppliedListeners[e]={}}var a=T.call(this,e);if(t.callAfterInitialVariant||a){var n={appComponent:this.oAppComponent,reference:this.sFlexReference,vmReference:e,flexController:this.oFlexController};h.waitForInitialVariantChanges(n).then(function(){var a=h.getCurrentVariantReference({vmReference:e,reference:this.sFlexReference});this._callVariantSwitchListeners(e,a,t.callback)}.bind(this))}return S(t.control).then(function(){if(p.getRelevantVariantManagementControlId(t.control,this.getVariantManagementControlIds())===t.vmControlId){this.oData[e].showExecuteOnSelection=true;this.checkUpdate(true);this._oVariantAppliedListeners[e][t.control.getId()]=t.callback}else{o.error("Error in attachVariantApplied: The passed VariantManagement ID does not match the responsible VariantManagement control")}}.bind(this))}.bind(this,t,e))};_.prototype._callVariantSwitchListeners=function(e,a,n){if(this._oVariantAppliedListeners[e]){var r;this.oData[e].variants.some(function(e){if(e.key===a){r=e;return true}});if(n){n(r)}else{t(this._oVariantAppliedListeners[e],function(e,t){t(r)})}}};_.prototype.detachVariantApplied=function(e,t){var a=this.getVariantManagementReferenceForControl(sap.ui.getCore().byId(e));if(this._oVariantAppliedListeners[a]){delete this._oVariantAppliedListeners[a][t]}};_.prototype.addChange=function(e){var t=e.getVariantReference();var a=this.getVariantManagementReference(t).variantManagementReference;this.oData[a].modified=!!this.oData[a].variantsEditable;this.checkUpdate(true);return h.addChangeToVariant({reference:this.sFlexReference,change:e,vmReference:a,vReference:t})};_.prototype.removeChange=function(e){var t=e.getVariantReference();var a=this.getVariantManagementReference(t).variantManagementReference;return h.removeChangeFromVariant({reference:this.sFlexReference,change:e,vmReference:a,vReference:t})};_.prototype._getVariantTitleCount=function(e,t){var a=this.getData();return a[t].variants.reduce(function(t,a){if(e.toLowerCase()===a.title.toLowerCase()&&a.visible){t++}return t},0)};_.prototype._duplicateVariant=function(e){var t=e.newVariantReference;var a=e.sourceVariantReference;var n=e.variantManagementReference;var i=this.getVariant(a);var o=h.getControlChangesForVariant({vmReference:n,vReference:a,changeInstance:true,reference:this.sFlexReference}).map(function(e){return e.getDefinition()});var s={content:{},controlChanges:o,variantChanges:{}};var c=m.compareAgainstCurrentLayer(i.content.layer,!this._bDesignTimeMode?d.USER:"");Object.keys(i.content).forEach(function(n){if(n==="fileName"){s.content[n]=t}else if(n==="variantReference"){if(c===0){s.content[n]=i.content["variantReference"]}else if(c===-1){s.content[n]=a}}else if(n==="content"){s.content[n]=JSON.parse(JSON.stringify(i.content[n]));s.content.content.title=e.title}else{s.content[n]=i.content[n]}});s.content["layer"]=e.layer;o=s.controlChanges.slice();var l={};var f;s.controlChanges=o.reduce(function(e,t){if(m.compareAgainstCurrentLayer(t.layer,!this._bDesignTimeMode?d.USER:"")===0){l=r({},t);l.variantReference=s.content.fileName;if(!l.support){l.support={}}l.support.sourceChangeFileName=t.fileName;l.packageName="$TMP";f=v.createInitialFileContent(l);e.push(new v(f))}return e}.bind(this),[]);return s};_.prototype.copyVariant=function(e){var t=this._duplicateVariant(e);var a={key:t.content.fileName,layer:e.layer,title:t.content.content.title,originalTitle:t.content.content.title,originalExecuteOnSelect:t.content.content.executeOnSelect,executeOnSelect:false,favorite:true,originalFavorite:true,rename:true,change:true,remove:true,visible:true,originalVisible:true};var n=p.createVariant({appVersion:this.oFlexController.getAppVersion(),model:this,variantSpecificData:t});var i=[];[n].concat(n.getControlChanges()).forEach(function(e){i.push(this.oChangePersistence.addDirtyChange(e))}.bind(this));var o=h.addVariantToVariantManagement({variantData:r({},n.getDefinitionWithChanges(),{content:{content:{visible:a.visible,favorite:a.favorite}}}),reference:this.sFlexReference,vmReference:e.variantManagementReference});this.oData[e.variantManagementReference].variants.splice(o,0,a);return this.updateCurrentVariant(e.variantManagementReference,n.getId(),e.appComponent,true).then(function(){return i})};_.prototype.removeVariant=function(e){var t=this.oChangePersistence.getDirtyChanges().filter(function(t){return t.getVariantReference&&t.getVariantReference()===e.variant.getId()||t.getId()===e.variant.getId()});return this.updateCurrentVariant(e.variantManagementReference,e.sourceVariantReference,e.component).then(function(){var a=h.removeVariantFromVariantManagement({reference:this.sFlexReference,variant:e.variant,vmReference:e.variantManagementReference});this.oData[e.variantManagementReference].variants.splice(a,1);this.checkUpdate();t.forEach(function(e){this.oChangePersistence.deleteChange(e)}.bind(this))}.bind(this))};_.prototype.collectModelChanges=function(e,t){var a=this.getData()[e];var n=a.variants;var r=[];var i={};n.forEach(function(e){if(e.originalTitle!==e.title){i={variantReference:e.key,changeType:"setTitle",title:e.title,originalTitle:e.originalTitle,layer:t};r.push(i)}if(e.originalFavorite!==e.favorite){i={variantReference:e.key,changeType:"setFavorite",favorite:e.favorite,originalFavorite:e.originalFavorite,layer:t};r.push(i)}if(e.originalExecuteOnSelect!==e.executeOnSelect){i={variantReference:e.key,changeType:"setExecuteOnSelect",executeOnSelect:e.executeOnSelect,originalExecuteOnSelect:e.originalExecuteOnSelect,layer:t};r.push(i)}if(!e.visible&&e.originalVisible){i={variantReference:e.key,changeType:"setVisible",visible:false,layer:t};r.push(i)}});if(a.originalDefaultVariant!==a.defaultVariant){i={variantManagementReference:e,changeType:"setDefault",defaultVariant:a.defaultVariant,originalDefaultVariant:a.originalDefaultVariant,layer:t};r.push(i)}return r};_.prototype.manageVariants=function(e,t,a,n){return new Promise(function(r){e.attachEventOnce("manage",{resolve:r,variantManagementReference:t,layer:a},this.fnManageClickRta,this);e.openManagementDialog(true,n)}.bind(this))};_.prototype.setVariantProperties=function(e,t,a){var n=-1;var r;var i=null;var o=this.getData();if(t.variantReference){n=this.getVariantManagementReference(t.variantReference).variantIndex;r=o[e].variants[n]}var c={};var l={};switch(t.changeType){case"setTitle":l.title=t.title;r.title=t.title;r.originalTitle=r.title;break;case"setFavorite":l.favorite=t.favorite;r.favorite=t.favorite;r.originalFavorite=r.favorite;break;case"setExecuteOnSelect":l.executeOnSelect=t.executeOnSelect;if(r){r.executeOnSelect=t.executeOnSelect;r.originalExecuteOnSelect=r.executeOnSelect}break;case"setVisible":l.visible=t.visible;l.createdByReset=false;r.visible=t.visible;r.originalVisible=r.visible;break;case"setDefault":l.defaultVariant=t.defaultVariant;o[e].defaultVariant=t.defaultVariant;o[e].originalDefaultVariant=o[e].defaultVariant;var u=f.getStoredHashParams({model:this});if(u){if(o[e].defaultVariant!==o[e].currentVariant&&u.indexOf(o[e].currentVariant)===-1){f.update({parameters:u.concat(o[e].currentVariant),updateURL:!this._bDesignTimeMode,updateHashEntry:true,model:this})}else if(o[e].defaultVariant===o[e].currentVariant&&u.indexOf(o[e].currentVariant)>-1){u.splice(u.indexOf(o[e].currentVariant),1);f.update({parameters:u,updateURL:!this._bDesignTimeMode,updateHashEntry:true,model:this})}}if(!a&&o[e].currentVariant!==t.defaultVariant){this.updateCurrentVariant(e,t.defaultVariant,t.appComponent)}break;default:break}var p=h.getContent(this.sFlexReference);if(n>-1){var v=h.setVariantData({variantData:l,vmReference:e,previousIndex:n,reference:this.sFlexReference});o[e].variants.splice(n,1);o[e].variants.splice(v,0,r)}else if(p[e]){p[e].defaultVariant=t.defaultVariant}var d={vmReference:e,add:a,reference:this.sFlexReference};if(a===true){c.changeType=t.changeType;c.layer=t.layer;if(t.changeType==="setDefault"){c.fileType="ctrl_variant_management_change";c.selector=s.getSelector(e,t.appComponent)}else{if(t.changeType==="setTitle"){g.setTextInChange(c,"title",t.title,"XFLD")}c.fileType="ctrl_variant_change";c.selector=s.getSelector(t.variantReference,t.appComponent)}i=this.oFlexController.createBaseChange(c,t.appComponent);i.setContent(l);d.changeContent=i.getDefinition();h.updateChangesForVariantManagementInMap(d);this.oChangePersistence.addDirtyChange(i)}else if(t.change){d.changeContent=t.change.getDefinition();h.updateChangesForVariantManagementInMap(d);this.oChangePersistence.deleteChange(t.change)}this.setData(o);this.checkUpdate(true);return i};_.prototype._ensureStandardVariantExists=function(t){var a=this.getData();var i=a[t]||{};var s=e(i,["initPromise"]);if(!a[t]||n(s)){a[t]=r(i,{currentVariant:t,originalCurrentVariant:t,defaultVariant:t,originalDefaultVariant:t,variants:[{key:t,title:this._oResourceBundle.getText("STANDARD_VARIANT_TITLE"),originalTitle:this._oResourceBundle.getText("STANDARD_VARIANT_ORIGINAL_TITLE"),favorite:true,originalFavorite:true,executeOnSelect:false,originalExecuteOnSelect:false,visible:true,originalVisible:true,author:p.DEFAULT_AUTHOR}]});this.setData(a);var c={};c[t]={defaultVariant:t,variantManagementChanges:{},variants:[{content:{fileName:t,fileType:"ctrl_variant",variantManagementReference:t,variantReference:"",support:{user:p.DEFAULT_AUTHOR},content:{title:this._oResourceBundle.getText("STANDARD_VARIANT_TITLE"),favorite:true,visible:true,executeOnSelect:false}},controlChanges:[],variantChanges:{}}]};try{var l=h.getContent(this.sFlexReference);r(l,c)}catch(e){o.error("Variants Map was not found: "+e.message)}}};_.prototype.setModelPropertiesForControl=function(e,t,a){this.oData[e].modified=false;this.oData[e].showFavorites=true;var n=this._bDesignTimeMode;if(n!==t){this._bDesignTimeMode=t;if(t){f.clearAllVariantURLParameters({model:this})}else if(n){f.update({parameters:f.getStoredHashParams({model:this}),updateURL:true,updateHashEntry:false,model:this})}}if(!(typeof this.fnManageClick==="function"&&typeof this.fnManageClickRta==="function")){this._initializeManageVariantsEvents()}a.detachManage(this.fnManageClick,this);if(t){this.oData[e].variantsEditable=false;this.oData[e].variants.forEach(function(a){a.rename=true;a.change=true;a.remove=M(a,e,t)})}else if(this.oData[e]._isEditable){a.attachManage({variantManagementReference:e},this.fnManageClick,this);this.oData[e].variantsEditable=true;this.oData[e].variants.forEach(function(a){a.remove=M(a,e,t);if(a.layer===m.getCurrentLayer(true)){a.rename=true;a.change=true}else{a.rename=false;a.change=false}})}else{this.oData[e].variantsEditable=false;this.oData[e].variants.forEach(function(e){e.remove=false;e.rename=false;e.change=false})}};_.prototype._initializeManageVariantsEvents=function(){this.fnManageClickRta=function(e,t){var a=this.collectModelChanges(t.variantManagementReference,t.layer);t.resolve(a)};this.fnManageClick=function(e,t){if(!this.oFlexController||!h.getContent(this.sFlexReference)){return}var a=this.collectModelChanges(t.variantManagementReference,m.getCurrentLayer(true));var n=[];a.forEach(function(e){e.appComponent=this.oAppComponent;n.push(this.setVariantProperties(t.variantManagementReference,e,true))}.bind(this));this.oChangePersistence.saveDirtyChanges(this.oAppComponent,false,n)}};_.prototype._handleSave=function(e){var t=e.getSource();var a=V.getAppComponentForControl(t);var n=this.getLocalId(t.getId(),a);return b(function(e,t,a){var n=a.def;var r=a.execute;var i=this.getCurrentVariantReference(e);var o=h.getControlChangesForVariant({reference:this.sFlexReference,vmReference:e,vReference:i,changeInstance:true});if(a["overwrite"]){return this.oFlexController.saveSequenceOfDirtyChanges(this._getDirtyChangesFromVariantChanges(o),t).then(function(t){this.checkDirtyStateForControlModels([e]);return t}.bind(this))}var s=V.createDefaultFileName();var c={variantManagementReference:e,appComponent:t,layer:m.getCurrentLayer(true),title:a["name"],sourceVariantReference:i,newVariantReference:s};return this.copyVariant(c).then(function(a){if(n){var c={changeType:"setDefault",defaultVariant:s,originalDefaultVariant:this.oData[e].defaultVariant,appComponent:t,layer:m.getCurrentLayer(true),variantManagementReference:e};var l=this.setVariantProperties(e,c,true);a.push(l)}if(r){var f={changeType:"setExecuteOnSelect",executeOnSelect:true,variantReference:s,appComponent:t,layer:m.getCurrentLayer(true),variantManagementReference:e};var u=this.setVariantProperties(e,f,true);a.push(u)}this.oData[e].modified=false;this.checkUpdate(true);return y({changes:o,vmReference:e,vReference:i,model:this}).then(this.oFlexController.saveSequenceOfDirtyChanges.bind(this.oFlexController,a,t))}.bind(this))}.bind(this,n,a,e.getParameters()),this,n)};_.prototype.getLocalId=function(e,t){return s.getSelector(e,t).id};_.prototype.getVariantManagementReferenceForControl=function(e){var t=e.getId();var a=V.getAppComponentForControl(e);return a&&a.getLocalId(t)||t};_.prototype.switchToDefaultForVariantManagement=function(e){if(this.oData[e].currentVariant!==this.oData[e].defaultVariant){c.show(200);this.updateCurrentVariant(e,this.oData[e].defaultVariant).then(function(){c.hide()})}};_.prototype.switchToDefaultForVariant=function(e){Object.keys(this.oData).forEach(function(t){if(!e||this.oData[t].currentVariant===e){this.switchToDefaultForVariantManagement(t)}}.bind(this))};_.prototype.registerToModel=function(e){var t=this.getVariantManagementReferenceForControl(e);this._ensureStandardVariantExists(t);this.oData[t]._isEditable=e.getEditable();this.oData[t]._executeOnSelectionForStandardDefault=e.getExecuteOnSelectionForStandardDefault();this.oData[t].showExecuteOnSelection=false;e.attachEvent("select",{vmReference:t,model:this},R);e.attachSave(this._handleSave,this);this.setModelPropertiesForControl(t,false,e);var a=e.getUpdateVariantInURL();this.oData[t].updateVariantInURL=a;f.registerControl({vmReference:t,updateURL:!!a,model:this});f.handleModelContextChange({model:this,vmControl:e});if(this.oData[t].initPromise){this.oData[t].initPromise.resolveFunction();delete this.oData[t].initPromise}this.oData[t].init=true};_.prototype.waitForVMControlInit=function(e){if(!this.oData[e]){this.oData[e]={}}else if(this.oData[e].init){return Promise.resolve()}this.oData[e].initPromise={};this.oData[e].initPromise.promise=new Promise(function(t){this.oData[e].initPromise.resolveFunction=t}.bind(this));return this.oData[e].initPromise.promise};_.prototype._getDirtyChangesFromVariantChanges=function(e){var t=e.map(function(e){return e.getDefinition().fileName});return this.oChangePersistence.getDirtyChanges().filter(function(e){return a(t,e.getId())})};_.prototype.checkDirtyStateForControlModels=function(e){e.forEach(function(e){var t=this.oData[e];if(t.modified===true){var a=this.getCurrentVariantReference(e);var n=h.getControlChangesForVariant({reference:this.sFlexReference,vmReference:e,vReference:a,changeInstance:true});var r=this._getDirtyChangesFromVariantChanges(n);if(r.length===0){t.modified=false}}}.bind(this));this.checkUpdate(true)};_.prototype.getCurrentControlVariantIds=function(){return Object.keys(this.oData||{}).reduce(function(e,t){return e.concat([this.oData[t].currentVariant])}.bind(this),[])};_.prototype.getVariantManagementControlIds=function(){var e;return Object.keys(this.oData||{}).reduce(function(t,a){if(this.oAppComponent.byId(a)){e=this.oAppComponent.createId(a)}else{e=a}t.push(e);return t}.bind(this),[])};_.prototype.resetMap=function(){var e=Object.keys(this.oData);e.forEach(function(e){var t={vmReference:e,currentVReference:this.oData[e].currentVariant||this.oData[e].defaultVariant,newVReference:true,appComponent:this.oAppComponent,flexController:this.oFlexController,modifier:s,reference:this.sFlexReference};return b(x.bind(this,t),this,e)}.bind(this));return this._oVariantSwitchPromise.then(function(){h.resetContent(this.sFlexReference);f.initialize({model:this});f.update({parameters:[],updateHashEntry:true,model:this})}.bind(this))};return _},true);