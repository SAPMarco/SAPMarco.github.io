/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/LayerUtils","sap/ui/fl/Utils"],function(e,n,t,r,a,i,o){"use strict";var l={};function c(e){e.reference=t.getFlexReferenceForControl(e.selector);return n.initialize({componentId:o.getAppComponentForControl(e.selector).getId(),reference:e.reference,componentData:{},manifest:{}})}function f(e){var t=n.getCompEntitiesByIdMap(e.reference);var r=Object.keys(t).map(function(e){return t[e]});return i.filterChangeOrChangeDefinitionsByCurrentLayer(r,e.currentLayer)}function s(e){if(!e.reference){var n=r.getAppComponentForSelector(e.selector);e.reference=t.getFlexReferenceForControl(n)}return a.getChangePersistenceForComponent(e.reference)}function u(n){var t=s(n);return t.getChangesForComponent(e(n,["invalidateCache","selector"]),n.invalidateCache)}l.getFlexObjects=function(e){return c(e).then(function(){var n=f(e);var t=u(e);return Promise.all([n,t]).then(function(e){return e[0].concat(e[1])})})};return l});