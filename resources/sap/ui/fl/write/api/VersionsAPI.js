/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/write/_internal/Versions","sap/ui/fl/Utils","sap/ui/fl/apply/_internal/flexState/ManifestUtils"],function(e,r,t,n){"use strict";function o(e){if(e){var r=e.getManifest();var o=n.getFlexReference({manifest:r,componentData:e.getComponentData()});var i=t.getAppVersionFromManifest(r)}return{reference:o,appVersion:i}}var i={};i.initialize=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}var n=t.getAppComponentForControl(e.selector);var i=o(n);if(!i.reference){return Promise.reject("The application ID could not be determined")}return r.initialize({reference:t.normalizeReference(i.reference),layer:e.layer})};i.isDraftAvailable=function(e){if(!e.selector){throw Error("No selector was provided")}if(!e.layer){throw Error("No layer was provided")}var n=t.getAppComponentForControl(e.selector);var i=o(n);if(!i.reference){throw Error("The application ID could not be determined")}var a=r.getVersionsModel({reference:t.normalizeReference(i.reference),layer:e.layer}).getProperty("/versions");var c=a.find(function(e){return e.version===sap.ui.fl.Versions.Draft});return!!c};i.loadDraftForApplication=function(r){if(!r.selector){return Promise.reject("No selector was provided")}if(!r.layer){return Promise.reject("No layer was provided")}var n=t.getAppComponentForControl(r.selector);var i=o(n);if(!i.reference){return Promise.reject("The application ID could not be determined")}return e.clearAndInitialize({componentId:n.getId(),reference:i.reference,version:sap.ui.fl.Versions.Draft})};i.activateDraft=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.title){return Promise.reject("No version title was provided")}var n=t.getAppComponentForControl(e.selector);var i=o(n);if(!i.reference){return Promise.reject("The application ID could not be determined")}return r.activateDraft({nonNormalizedReference:i.reference,reference:t.normalizeReference(i.reference),appVersion:i.appVersion,layer:e.layer,title:e.title,appComponent:n})};i.discardDraft=function(n){if(!n.selector){return Promise.reject("No selector was provided")}if(!n.layer){return Promise.reject("No layer was provided")}var i=t.getAppComponentForControl(n.selector);var a=o(i);if(!a.reference){return Promise.reject("The application ID could not be determined")}return r.discardDraft({nonNormalizedReference:a.reference,reference:t.normalizeReference(a.reference),layer:n.layer,appVersion:a.appVersion}).then(function(r){if(r.backendChangesDiscarded){e.clearAndInitialize({componentId:i.getId(),reference:a.reference})}return r})};return i});