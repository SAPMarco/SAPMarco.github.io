/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/write/_internal/Versions","sap/ui/fl/Utils","sap/ui/fl/apply/_internal/flexState/ManifestUtils"],function(e,r,t,o){"use strict";var n={};n.initialize=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}var o=t.getAppComponentForControl(e.selector);var n=t.getComponentClassName(o);if(!n){return Promise.reject("The application ID could not be determined")}return r.initialize({reference:t.normalizeReference(n),layer:e.layer})};n.isDraftAvailable=function(e){var r=n.getVersions(e);var t=r.find(function(e){return e.versionNumber===0});return!!t};n.getVersions=function(e){if(!e.selector){throw Error("No selector was provided")}if(!e.layer){throw Error("No layer was provided")}var o=t.getAppComponentForControl(e.selector);var n=t.getComponentClassName(o);if(!n){throw Error("The application ID could not be determined")}return r.getVersions({reference:t.normalizeReference(n),layer:e.layer})};n.loadDraftForApplication=function(r){if(!r.selector){return Promise.reject("No selector was provided")}if(!r.layer){return Promise.reject("No layer was provided")}var o=t.getAppComponentForControl(r.selector);var n=t.getComponentClassName(o);if(!n){return Promise.reject("The application ID could not be determined")}return e.clearAndInitialize({componentId:o.getId(),reference:n,draftLayer:r.layer})};n.activateDraft=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.title){return Promise.reject("No version title was provided")}var n=t.getAppComponentForControl(e.selector);if(n){var i=n.getManifest();var a=o.getFlexReference({manifest:i,componentData:n.getComponentData()});var l=t.getAppVersionFromManifest(i)}if(!a){return Promise.reject("The application ID could not be determined")}return r.activateDraft({nonNormalizedReference:a,reference:t.normalizeReference(a),appVersion:l,layer:e.layer,title:e.title})};n.discardDraft=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}var i=t.getAppComponentForControl(e.selector);if(i){var a=i.getManifest();var l=o.getFlexReference({manifest:a,componentData:i.getComponentData()});var s=t.getAppVersionFromManifest(a)}if(!l){return Promise.reject("The application ID could not be determined")}return r.discardDraft({nonNormalizedReference:l,reference:t.normalizeReference(l),layer:e.layer,appVersion:s}).then(function(r){if(r){n.loadDraftForApplication({selector:e.selector,layer:e.layer})}return r})};return n});