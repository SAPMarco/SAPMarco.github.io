/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BaseContentRenderer","sap/ui/core/Core","sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/ui/base/ManagedObjectObserver","sap/ui/integration/util/LoadingProvider"],function(t,e,i,o,r,a){"use strict";var n=i.extend("sap.ui.integration.cards.BaseContent",{metadata:{library:"sap.ui.integration",aggregations:{_content:{multiple:false,visibility:"hidden"}},associations:{card:{type:"sap.ui.integration.widgets.Card",multiple:false}},events:{press:{}}},renderer:t});n.prototype.init=function(){this._iWaitingEventsCount=0;this._bReady=false;this._mObservers={};this._awaitEvent("_dataReady");this._awaitEvent("_actionContentReady");this._oLoadingProvider=new a};n.prototype.ontap=function(t){if(!t.isMarked()){this.firePress({})}};n.prototype.exit=function(){this._iWaitingEventsCount=0;if(this._mObservers){Object.keys(this._mObservers).forEach(function(t){this._mObservers[t].disconnect();delete this._mObservers[t]},this)}this._oServiceManager=null;this._oDataProviderFactory=null;this._oIconFormatter=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null}if(this._oActions){this._oActions.destroy();this._oActions=null}if(this._oLoadingProvider){this._oLoadingProvider.destroy();this._oLoadingProvider=null}if(this._oLoadingPlaceholder){this._oLoadingPlaceholder.destroy();this._oLoadingPlaceholder=null}};n.prototype.loadDependencies=function(t){return Promise.resolve()};n.prototype.getActions=function(){return this._oActions};n.prototype.setActions=function(t){this._oActions=t};n.prototype._awaitEvent=function(t){this._iWaitingEventsCount++;this.attachEventOnce(t,function(){this._iWaitingEventsCount--;if(this._iWaitingEventsCount===0){this._bReady=true;this.fireEvent("_ready")}})};n.prototype.setConfiguration=function(t,e){this._oConfiguration=t;if(!t){return this}this._oLoadingPlaceholder=this._oLoadingProvider.createContentPlaceholder(t,e);this._setDataConfiguration(t.data);return this};n.prototype.getConfiguration=function(){return this._oConfiguration};n.prototype._setDataConfiguration=function(t){if(!t){this.fireEvent("_dataReady");return}this.bindObject(t.path||"/");if(this._oDataProvider){this._oDataProvider.destroy()}if(this._oDataProviderFactory){this._oDataProvider=this._oDataProviderFactory.create(t,this._oServiceManager)}if(this._oDataProvider){this.setModel(new o);this._oDataProvider.attachDataRequested(function(){this.onDataRequested()}.bind(this));this._oDataProvider.attachDataChanged(function(t){this._updateModel(t.getParameter("data"));this.onDataChanged();this.onDataRequestComplete()}.bind(this));this._oDataProvider.attachError(function(t){this._handleError(t.getParameter("message"));this.onDataRequestComplete()}.bind(this));this._oDataProvider.triggerDataUpdate()}else{this.fireEvent("_dataReady")}};n.prototype.destroyPlaceholder=function(){var t=this.getAggregation("_content");if(t){t.removeStyleClass("sapFCardContentHidden")}if(this._oLoadingPlaceholder){this._oLoadingPlaceholder.destroy();this._oLoadingPlaceholder=null}};n.prototype.onDataChanged=function(){};function s(t,e,i){var o=this.getBindingContext(),a=e.getAggregation(t);if(o){i.path=i.path||o.getPath();e.bindAggregation(t,i);if(this.getModel("parameters")&&a){this.getModel("parameters").setProperty("/visibleItems",a.length)}if(!this._mObservers[t]){this._mObservers[t]=new r(function(i){if(i.name===t&&(i.mutation==="insert"||i.mutation==="remove")){var o=e.getAggregation(t);var r=o?o.length:0;if(this.getModel("parameters")){this.getModel("parameters").setProperty("/visibleItems",r)}}}.bind(this));this._mObservers[t].observe(e,{aggregations:[t]})}}}n.prototype._bindAggregationToControl=function(t,e,i){var o=t&&typeof t==="string";var r=i&&typeof i==="object";if(!o||!e||!r){return}if(this.getBindingContext()){s.apply(this,arguments)}else{e.attachModelContextChange(s.bind(this,t,e,i))}};n.prototype.isReady=function(){return this._bReady};n.prototype._updateModel=function(t){this.getModel().setData(t)};n.prototype._handleError=function(t){this.fireEvent("_error",{logMessage:t})};n.prototype.setServiceManager=function(t){this._oServiceManager=t;return this};n.prototype.setDataProviderFactory=function(t){this._oDataProviderFactory=t;return this};n.prototype.setIconFormatter=function(t){this._oIconFormatter=t;return this};n.prototype.isLoading=function(){var t=this._oLoadingProvider,e=this.getCardInstance();return!t.getDataProviderJSON()&&(t.getLoadingState()||e&&e.isLoading())};n.prototype.attachPress=function(){var t=Array.prototype.slice.apply(arguments);t.unshift("press");i.prototype.attachEvent.apply(this,t);this.invalidate();return this};n.prototype.detachPress=function(){var t=Array.prototype.slice.apply(arguments);t.unshift("press");i.prototype.detachEvent.apply(this,t);this.invalidate();return this};n.prototype.onActionSubmitStart=function(t){};n.prototype.onActionSubmitEnd=function(t,e){};n.prototype.onDataRequested=function(){if(this._oLoadingProvider){this._oLoadingProvider.createLoadingState(this._oDataProvider)}};n.prototype.onDataRequestComplete=function(){this.fireEvent("_dataReady");this.destroyPlaceholder();if(this._oLoadingProvider){this._oLoadingProvider.setLoading(false)}};n.prototype.getCardInstance=function(){return e.byId(this.getCard())};return n});