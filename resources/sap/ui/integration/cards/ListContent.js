/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BaseListContent","./ListContentRenderer","sap/ui/util/openWindow","sap/m/library","sap/m/List","sap/ui/integration/library","sap/ui/integration/util/BindingHelper","sap/ui/integration/controls/Microchart","sap/ui/integration/controls/MicrochartLegend","sap/ui/integration/controls/ListContentItem"],function(t,e,i,n,o,a,r,s,c,l){"use strict";var p=n.AvatarSize;var h=n.AvatarColor;var g=n.ListType;var d=a.CardActionArea;var f=t.extend("sap.ui.integration.cards.ListContent",{metadata:{aggregations:{_legend:{multiple:false,visibility:"hidden"}}},renderer:e});f.prototype.init=function(){t.prototype.init.apply(this,arguments);var e=this._getList();var i=this;this.setAggregation("_content",e);e.attachUpdateFinished(function(){if(i._iVisibleItems){var t=e.getItems();for(var n=i._iVisibleItems+1;n<t.length;n++){t[n].setVisible(false)}}});this._oItemTemplate=new l({iconDensityAware:false})};f.prototype.exit=function(){t.prototype.exit.apply(this,arguments);if(this._oItemTemplate){this._oItemTemplate.destroy();this._oItemTemplate=null}};f.prototype.loadDependencies=function(t){if(t.get("/sap.card/content/item/chart")){return s.loadDependencies()}return Promise.resolve()};f.prototype.setConfiguration=function(e){t.prototype.setConfiguration.apply(this,arguments);if(!e){return this}if(e.items){this._setStaticItems(e.items);return this}if(e.item){this._setItem(e.item)}return this};f.prototype.onDataChanged=function(){this._checkHiddenNavigationItems(this.getConfiguration().item)};f.prototype.hideContent=function(){t.prototype.hideContent.call(this);var e=this.getAggregation("_legend");if(e){e.addStyleClass("sapFCardContentHidden")}};f.prototype.showContent=function(){t.prototype.showContent.apply(this,arguments);var e=this.getAggregation("_legend");if(e){e.removeStyleClass("sapFCardContentHidden")}};f.prototype._getList=function(){if(this._bIsBeingDestroyed){return null}if(!this._oList){this._oList=new o({id:this.getId()+"-list",growing:false,showNoData:false,showSeparators:"None"})}return this._oList};f.prototype._setItem=function(t){var e={iconDensityAware:false,title:t.title&&(t.title.value||t.title),description:t.description&&(t.description.value||t.description),highlight:t.highlight,info:t.info&&t.info.value,infoState:t.info&&t.info.state};if(t.icon){e.icon=r.formattedProperty(t.icon.src,function(t){return this._oIconFormatter.formatSrc(t)}.bind(this));e.iconAlt=t.icon.alt;e.iconDisplayShape=t.icon.shape;e.iconInitials=t.icon.text;if(e.title&&e.description){e.iconSize=p.S}else{e.iconSize=p.XS}e.iconSize=t.icon.size||e.iconSize;e.iconBackgroundColor=t.icon.backgroundColor||(t.icon.text?undefined:h.Transparent)}if(t.chart){e.microchart=this._createChartAndAddLegend(t.chart)}this._oItemTemplate=new l(e);this._oActions.attach({area:d.ContentItem,actions:t.actions,control:this,actionControl:this._oItemTemplate,enabledPropertyName:"type",enabledPropertyValue:g.Navigation,disabledPropertyValue:g.Inactive});var i={template:this._oItemTemplate};this._filterHiddenNavigationItems(t,i);this._bindAggregationToControl("items",this._getList(),i)};f.prototype._createChartAndAddLegend=function(t){var e=s.create(t);this.destroyAggregation("_legend");if(t.type==="StackedBar"){var i=new c({chart:e.getChart()});i.initItemsTitles(t.bars,this.getBindingContext().getPath());this.setAggregation("_legend",i)}return e};f.prototype._setStaticItems=function(t){var e=this._getList();t.forEach(function(t){var n=new l({iconDensityAware:false,title:t.title?t.title:"",description:t.description?t.description:"",icon:t.icon?t.icon:"",infoState:t.infoState?t.infoState:"None",info:t.info?t.info:"",highlight:t.highlight?t.highlight:"None"});if(t.action){n.setType("Navigation");if(t.action.url){n.attachPress(function(){i(t.action.url,t.target||"_blank")})}}e.addItem(n)});this.fireEvent("_actionContentReady")};f.prototype.getInnerList=function(){return this._getList()};return f});