/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["ui5loader","sap/ui/core/Control","sap/ui/core/Core","sap/base/util/deepClone","sap/base/util/merge","sap/ui/integration/widgets/Card","sap/ui/integration/Designtime","sap/ui/model/json/JSONModel","sap/ui/integration/util/CardMerger","sap/m/Label","sap/m/Title","sap/ui/core/Icon","sap/m/ResponsivePopover","sap/m/Popover","sap/m/Text","sap/base/Log","sap/ui/core/Popup","sap/base/i18n/ResourceBundle","sap/ui/thirdparty/URI","sap/ui/dom/includeStylesheet","sap/base/util/LoaderExtensions","sap/ui/core/theming/Parameters"],function(e,t,i,a,n,s,r,o,l,d,f,u,g,p,h,_,c,m,v,y,C,b){"use strict";var D=p.prototype.init;p.prototype.init=function(){D.apply(this,arguments);var e=this.oPopup._applyPosition,t=this;this.oPopup._applyPosition=function(){var i=t.close;t.close=function(){};e.apply(this,arguments);t.close=i}};function M(e){if(e&&e.nodeType!==1){return 0}var t=parseInt(window.getComputedStyle(e).getPropertyValue("z-index"));if(isNaN(t)){return M(e.parentNode)}return t+1}var P=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g,E=5e3,T=i.getLibraryResourceBundle("sap.ui.integration");var I=t.extend("sap.ui.integration.designtime.editor.CardEditor",{metadata:{library:"sap.ui.integration",properties:{card:{type:"any",defaultValue:null},mode:{type:"string",defaultValue:"admin"},language:{type:"string",defaultValue:""},allowDynamicValues:{type:"boolean",defaultValue:false},allowSettings:{type:"boolean",defaultValue:false},designtime:{type:"object"}},aggregations:{_formContent:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},_preview:{type:"sap.ui.integration.designtime.editor.CardPreview",multiple:false,visibility:"hidden"}},events:{ready:{}}},renderer:function(e,t){e.openStart("div");t.getMode()==="translation"?e.addClass("sapUiIntegrationCardEditorTranslation"):e.addClass("sapUiIntegrationCardEditorPreview");e.addClass("sapUiIntegrationCardEditor");e.writeClasses();e.writeElementData(t);e.openEnd();if(t.isReady()){e.openStart("div");e.addClass("sapUiIntegrationCardEditorForm");if(t.getMode()!=="translation"){e.addClass("settingsButtonSpace")}e.writeClasses();e.openEnd();var i=t.getAggregation("_formContent");if(i){var a,n=0;for(var s=0;s<i.length;s++){var r=i[s];if(r.isA("sap.m.Label")){a=r;continue}e.openStart("div");e.addClass("sapUiIntegrationCardEditorItem");if(t.getMode()==="translation"){e.addClass("language")}if(r._cols===1){e.addClass("sapUiIntegrationCardEditorItemCol"+ ++n)}else{n=0}e.writeClasses();e.openEnd();if(r.isA("sap.m.Title")){e.renderControl(r)}else{if(a){var o=a.getDependents()&&a.getDependents()[0];e.openStart("div");e.addClass("sapUiIntegrationCardEditorItemLabel");if(o&&t.getMode()!=="translation"){e.addClass("description")}e.openEnd();e.renderControl(a);if(o){e.renderControl(o)}e.close("div")}e.renderControl(r)}e.close("div");a=null;n=n==2?0:n}}e.close("div");var l=t.getAggregation("_preview");l&&e.renderControl(l)}e.close("div")}});I.prototype.init=function(){this._ready=false;this._aFieldReadyPromise=[];this._oResourceBundle=T;this._appliedLayerManifestChanges=[];this._currentLayerManifestChanges={};this._mDestinationDataProviders={}};I.prototype.isReady=function(){return this._ready};function w(e,t,i,a){a=a||"";i=i||[];if(typeof e==="object"){if(!e[t]){for(var n in e){w(e[n],t,i,a+"/"+n)}}else{if(e.type){i.push({path:e.pathvalue||a.substring(1),value:e.pathvalue||"{context>"+a.substring(1)+"/value}",object:e})}else{i.push({path:a.substring(1),object:e});for(var n in e){w(e[n],t,i,a+"/"+n)}}}}return i}I.prototype._filterManifestChangesByLayer=function(e){var t=[],i={":layer":l.layers[this.getMode()]},a=l.layers[this.getMode()];e.manifestChanges.forEach(function(e){var n=e.hasOwnProperty(":layer")?e[":layer"]:1e3;if(n<a){t.push(e)}else if(n===a){i=e}});e.manifestChanges=t;this._currentLayerManifestChanges=i};I.prototype.setCard=function(e,t){this._ready=false;if(e===this.getProperty("card")){return this}if(this._oEditorCard){this._oEditorCard.destroy()}if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy()}this.setProperty("card",e,t);Promise.resolve().then(function(){this._initCard(e)}.bind(this));return this};I.prototype.setLanguage=function(e,t){if(!e||typeof e!=="string"){return this}this._language=e.replace("-","_");this.setProperty("language",e,t);if(!I._languages[this._language]){this._language=this._language.split("_")[0]}if(!I._languages[this._language]){_.warning("The language: "+e+" is currently unknown, some UI controls might show "+e+" instead of the language name.")}return this};I.prototype.onAfterRendering=function(){if(this.getDomRef()){this._iZIndex=M(this.getDomRef());c.setInitialZIndex(this._iZIndex)}};I.prototype._getOriginalManifestJson=function(){try{return this._oEditorCard._oCardManifest._oManifest.getRawJson()}catch(e){return{}}};I.prototype._initCard=function(e){if(typeof e==="string"){try{e=JSON.parse(e)}catch(n){var t=i.byId(e);if(!t){var a=document.getElementById(e);if(a&&a.tagName&&a.tagName==="ui-integration-card"){t=a._getControl()}}e=t}}if(e&&e.isA&&e.isA("sap.ui.integration.widgets.Card")){e={manifest:e.getManifest(),manifestChanges:e.getManifestChanges(),host:e.getHost(),baseUrl:e.getBaseUrl()}}if(typeof e==="object"){var r=l.layers[this.getMode()];if(e.manifestChanges){this._filterManifestChangesByLayer(e)}this._oEditorCard=new s(e);var d=this;this._oEditorCard._prepareToApplyManifestSettings=function(){s.prototype._prepareToApplyManifestSettings.apply(this,arguments);if(!d._oEditorCard._isManifestReady){return}if(d._manifestModel){return}d._appliedLayerManifestChanges=e.manifestChanges;var t=d._oEditorCard.getManifestEntry("/");var i=n({},t);d._oProviderCard=d._oEditorCard;d._oProviderCard._editorManifest=t;d._beforeManifestModel=new o(i);if(r<l.layers["translation"]&&d._currentLayerManifestChanges){t=l.mergeCardDelta(t,[d._currentLayerManifestChanges])}d._manifestModel=new o(t);d._originalManifestModel=new o(d._getOriginalManifestJson());d._initInternal();if(!d._oEditorCard.getModel("i18n")){d._oEditorCard._loadDefaultTranslations()}d.setModel(d._oEditorCard.getModel("i18n"),"i18n");d._createContextModel()};this._oEditorCard.onBeforeRendering()}};I.prototype._initInternal=function(){var e=this._oEditorCard.getManifestEntry("/sap.card/designtime"),t=this._manifestModel.getProperty("/sap.card/configuration"),i,a=this.getDesigntime();if(a){if(typeof a==="function"){i=new Promise(function(e,t){var i=new a;this._applyDesigntimeDefaults(i.getSettings());e(i)}.bind(this))}else if(typeof a==="object"){i=new Promise(function(e,t){sap.ui.require(["sap/ui/integration/Designtime"],function(t){var i=t.extend("test.Designtime");i.prototype.create=function(){return a};var n=new i;this._applyDesigntimeDefaults(n.getSettings());e(n)}.bind(this))}.bind(this))}}else if(e){i=this._oEditorCard.loadDesigntime().then(function(e){this._applyDesigntimeDefaults(e.getSettings());return e}.bind(this))}else{i=Promise.resolve(this._createParameterDesigntime(t))}i.then(function(e){this._oDesigntimeInstance=e;if(this.getMode()==="admin"||this.getMode()==="all"){this._addDestinationSettings(t,this._oDesigntimeInstance)}this._settingsModel=new o(this._oDesigntimeInstance.getSettings());this.setModel(this._settingsModel,"currentSettings");this.setModel(this._settingsModel,"items");this._applyDesigntimeLayers();this._requireFields().then(function(){this._startEditor()}.bind(this))}.bind(this))};I.prototype.getCurrentSettings=function(){var e=this._settingsModel.getProperty("/"),t={},i;if(e&&e.form&&e.form.items){for(var a in e.form.items){var n=e.form.items[a];if(n.editable&&n.visible){if(this.getMode()!=="translation"){if(n.translatable&&!n._changed&&n._translatedDefaultPlaceholder&&!this._currentLayerManifestChanges[n.manifestPath]){continue}else{t[n.manifestpath]=n.value}}else if(n.translatable&&n.value){t[n.manifestpath]=n.value}if(n._next&&this.getAllowSettings()){if(n._next.editable===false){i=i||{};i[n._settingspath+"/editable"]=false}if(n._next.visible===false){i=i||{};i[n._settingspath+"/visible"]=false}if(typeof n._next.allowDynamicValues==="boolean"&&this.getAllowDynamicValues()){i=i||{};i[n._settingspath+"/allowDynamicValues"]=n._next.allowDynamicValues}}}}}t[":layer"]=l.layers[this.getMode()];t[":errors"]=this.checkCurrentSettings()[":errors"];if(i){t[":designtime"]=i}return t};I.prototype.checkCurrentSettings=function(){var e=this._settingsModel.getProperty("/"),t={};if(e&&e.form&&e.form.items){for(var i in e.form.items){var a=e.form.items[i];if(a.editable){if((a.isValid||a.required)&&!(this.getMode()==="translation"&&a.translatable)){if(a.isValid){t[a.manifestpath]=a.isValid(a)}t[a.manifestpath]=true;var n=a.value;var s=a.type;if(s==="string"&&n===""){t[a.manifestpath]=n}if((s==="date"||s==="datetime")&&isNaN(Date.parse(n))){t[a.manifestpath]=n}if(s==="integer"){if(isNaN(parseInt(n))){t[a.manifestpath]=n}else if(n<a.min||n>a.max){t[a.manifestpath]=n}}if(s==="number"){if(isNaN(parseFloat(n))){t[a.manifestpath]=n}else if(n<a.min||n>a.max){t[a.manifestpath]=n}}}}}t[":layer"]=l.layers[this.getMode()]}t[":errors"]=Object.values(t).indexOf(false)>-1;return t};I.prototype._createContextModel=function(){var e=this._oEditorCard.getHostInstance(),t=new o({}),i=new o([]);this.setModel(t,"context");this.setModel(i,"contextflat");i._getPathObject=function(e){var t=this.getData().filter(function(t){if(t.path===e){return true}});return t.length?t[0]:null};i._getValueObject=function(e){var t=this.getData()||[];t=t.filter(function(t){if(t.value===e||t.object.value===e){return true}});return t.length?t[0]:null};var a=new Promise(function(t,i){if(e&&e.getContext){var a=false;setTimeout(function(){if(a){return}_.error("Card Editor context could not be determined with "+E+".");a=true;t({})},E);e.getContext().then(function(e){if(a){_.error("Card Editor context returned after more than "+E+". Context is ignored.")}a=true;t(e||{})})}else{t({})}});a.then(function(e){var a={};a["empty"]=I._contextEntries.empty;for(var n in e){a[n]=e[n]}a["card.internal"]=I._contextEntries["card.internal"];t.setData(a);i.setData(w(a,"label"))});t.getProperty=function(t,i){var a=this.resolve(t,i);if(a.endsWith("/value")){this._mValues=this._mValues||{};if(this._mValues.hasOwnProperty(a)){return this._mValues[a]}this._mValues[a]=undefined;e.getContextValue(a.substring(1)).then(function(e){this._mValues[a]=e;this.checkUpdate()}.bind(this));return undefined}else{return o.prototype.getProperty.apply(this,arguments)}}};I.fieldMap={string:"sap/ui/integration/designtime/editor/fields/StringField",integer:"sap/ui/integration/designtime/editor/fields/IntegerField",number:"sap/ui/integration/designtime/editor/fields/NumberField",boolean:"sap/ui/integration/designtime/editor/fields/BooleanField",date:"sap/ui/integration/designtime/editor/fields/DateField",datetime:"sap/ui/integration/designtime/editor/fields/DateTimeField","string[]":"sap/ui/integration/designtime/editor/fields/ListField",destination:"sap/ui/integration/designtime/editor/fields/DestinationField"};I.Fields=null;I.prototype._requireFields=function(){if(I.Fields){return Promise.resolve()}return new Promise(function(e){sap.ui.require(Object.values(I.fieldMap),function(){I.Fields={};for(var t in I.fieldMap){I.Fields[t]=arguments[Object.keys(I.fieldMap).indexOf(t)]}e()})})};I.prototype._createLabel=function(e){var t=new d({text:e.label,required:e.required&&e.editable||false,visible:e.visible,objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"}}});t._cols=e.cols||2;if(e.description){var i=new u({src:"sap-icon://message-information",color:"Marker",size:"12px",useIconTooltip:false,visible:this.getMode()!=="translation"});i.addStyleClass("sapUiIntegrationCardEditorDescriptionIcon");t.addDependent(i);i.onmouseover=function(){this._getPopover().getContent()[0].applySettings({text:e.description});this._getPopover().openBy(i);i.addDependent(this._getPopover())}.bind(this);i.onmouseout=function(){this._getPopover().close();i.removeDependent(this._getPopover())}.bind(this)}return t};I.prototype._getPopover=function(){if(this._oPopover){return this._oPopover}var e=new h({text:""});e.addStyleClass("sapUiTinyMargin sapUiIntegrationCardEditorDescriptionText");this._oPopover=new g({showHeader:false,content:[e]});this._oPopover.addStyleClass("sapUiIntegrationCardEditorPopover");return this._oPopover};I.prototype._updateProviderCard=function(e){if(this._ready){var t=this._oProviderCard._editorManifest;if(e.length===0){return}for(var i=0;i<e.length;i++){var a=e[i];a.config._cancel=true}delete t["sap.card"].header;delete t["sap.card"].content;delete t["sap.card"].data;t["sap.card"].type="List";var n=this._oProviderCard;this._oProviderCard=new s({manifest:t,baseUrl:this._getBaseUrl(),host:this._oProviderCard.getHost()});this._oProviderCard.setManifestChanges([this.getCurrentSettings()]);this._oProviderCard._editorManifest=t;var r=this;this._oProviderCard._fillFiltersModel=function(){if(!r._oProviderCard._oDataProviderFactory){return}r._bIgnoreUpdates=true;for(var t=0;t<e.length;t++){var i=e[t];i.config._cancel=false;r._addValueListModel(i.config,i.field,true)}r._bIgnoreUpdates=false};this._oProviderCard.setVisible(false);this._oProviderCard.onBeforeRendering();if(n&&n!==this._oEditorCard){n.destroy()}}};I.prototype._createField=function(e){var t=new I.Fields[e.type]({configuration:e,mode:this.getMode(),host:this._oEditorCard.getHostInstance(),objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"}},visible:e.visible});this._aFieldReadyPromise.push(t._readyPromise);var i=this._settingsModel.bindProperty(e._settingspath+"/value");i.attachChange(function(){if(!this._bIgnoreUpdates){e._changed=true;if(e._dependentFields&&e._dependentFields.length>0){this._updateProviderCard(e._dependentFields)}this._updatePreview()}}.bind(this));this._addValueListModel(e,t);t._cols=e.cols||2;return t};I.prototype._addValueListModel=function(e,t,i){if(e.enum&&e.enum.length>0&&e.enum[0]!==""){e.enum=[""].concat(e.enum)}if(e.values&&e.values.data&&this._oProviderCard&&this._oProviderCard._oDataProviderFactory){var a=new o({}),n=this._oProviderCard._oDataProviderFactory.create(e.values.data).getData();this._settingsModel.setProperty(e._settingspath+"/_loading",true);n.then(function(t){if(e._cancel){e._values=[];return}t=[{}].concat(t);e._values=t;a.setData(t);a.checkUpdate(true);this._settingsModel.setProperty(e._settingspath+"/_loading",false)}.bind(this)).catch(function(){e._values={};a.setData({});a.checkUpdate(true);this._settingsModel.setProperty(e._settingspath+"/_loading",false)}.bind(this));t.setModel(a,undefined);t.bindObject({path:e.values.data.path||"/"});if(!i){var s=JSON.stringify(e.values.data);if(s){var r=/parameters\.([^\}\}]+)|destinations\.([^\}\}]+)/g,l=s.match(r);if(l){for(var d=0;d<l.length;d++){var f=l[d].indexOf("parameters.")===0?"/value":"/name",u="/sap.card/configuration/"+l[d].replace(".","/")+f,g=this._mItemsByPaths[u];if(g){g._dependentFields=g._dependentFields||[];g._dependentFields.push({field:t,config:e})}}}}}}};I.prototype._addItem=function(e){var t=this.getMode();if(this.getAllowDynamicValues()===false||!e.allowDynamicValues){e.allowDynamicValues=false}if(this.getAllowSettings()===false){e.allowSettings=false}e._beforeValue=this._beforeManifestModel.getProperty(e.manifestpath);e.__cols=e.cols||2;if(e.visible===false||!e.translatable&&t==="translation"){return}if(e.type==="group"){var i=new f({text:e.label,visible:e.visible,objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"}}});this.addAggregation("_formContent",i);i._cols=e.cols||2;return}if(t==="translation"){if(typeof e.value==="string"&&e.value.indexOf("{")===0){return}e._language={value:e.value};e.cols=1;var n=a(e,10);n._settingspath+="/_language";n.editable=false;n.required=false;n.value=n._beforeValue;if(!n.value){n.value="-"}this.addAggregation("_formContent",this._createLabel(n));this.addAggregation("_formContent",this._createField(n));e.value=e._translatedDefaultValue||"";e.editable=e.visible=e.translatable;if(this._currentLayerManifestChanges){e.value=this._currentLayerManifestChanges[e.manifestpath]||e.value}e.label=e._translatedLabel||"";e.required=false}this.addAggregation("_formContent",this._createLabel(e));var s=this._createField(e);this.addAggregation("_formContent",s);e.cols=e.__cols;delete e.__cols};I.prototype._getCurrentLanguageSpecificText=function(e){var t=this._language;if(this._oTranslationBundle){var i=this._oTranslationBundle.getText(e,[],true);if(i===undefined){return""}return i}if(!t){return""}var a=this._oEditorCard.getManifestEntry("/sap.app/i18n");if(!a){return""}if(typeof a==="string"){var n=[t];if(t.indexOf("_")>-1){n.push(t.substring(0,t.indexOf("_")))}this._oTranslationBundle=m.create({url:this._getBaseUrl()+a,async:false,locale:t,supportedLocales:n,fallbackLocale:""});return this._getCurrentLanguageSpecificText(e)}};I.prototype._getBaseUrl=function(){if(this._oEditorCard&&this._oEditorCard.isReady()){return this._oEditorCard.getBaseUrl()||this.oCardEditor._oEditorCard._oCardManifest.getUrl()}return""};I.prototype._startEditor=function(){var e=this._settingsModel.getProperty("/");if(e.form&&e.form.items){if(this.getMode()==="translation"){this._addItem({type:"group",cols:1,translatable:true,label:T.getText("CARDEDITOR_ORIGINALLANG")});this._addItem({type:"group",cols:1,translatable:true,label:I._languages[this._language]||this.getLanguage()})}this._mItemsByPaths={};for(var t in e.form.items){var i=e.form.items[t];if(i.manifestpath){this._mItemsByPaths[i.manifestpath]=i}if(i){i.label=i.label||t;var a=this._currentLayerManifestChanges[i.manifestpath];i._changed=a!==undefined;if(i.type==="string"){i._translatedDefaultPlaceholder=this._getManifestDefaultValue(i.manifestpath)||i.defaultValue;var n=null,s=i._translatedDefaultPlaceholder;if(s){if(this._isValueWithHandlebarsTranslation(s)){n=s.substring(2,s.length-2)}else if(s.startsWith("{i18n>")){n=s.substring(6,s.length-1)}if(n){i.translatable=true;i._translatedDefaultValue=this.getModel("i18n").getResourceBundle().getText(n);if(i._changed){i.value=a}else{i.value=i._translatedDefaultValue}if(this.getMode()==="translation"){i._translatedDefaultValue=this._getCurrentLanguageSpecificText(n)}}}if(this.getMode()==="translation"){if(this._isValueWithHandlebarsTranslation(i.label)){i._translatedLabel=this._getCurrentLanguageSpecificText(i.label.substring(2,i.label.length-2),true)}else if(i.label&&i.label.startsWith("{i18n>")){i._translatedLabel=this._getCurrentLanguageSpecificText(i.label.substring(6,i.label.length-1),true)}}}}}}for(var t in e.form.items){var i=e.form.items[t];this._addItem(i)}if(this.getMode()!=="translation"){this._initPreview().then(function(){Promise.all(this._aFieldReadyPromise).then(function(){this._ready=true;this.fireReady()}.bind(this))}.bind(this))}else{Promise.all(this._aFieldReadyPromise).then(function(){this._ready=true;this.fireReady()}.bind(this))}};I.prototype.destroy=function(){if(this._oEditorCard){this._oEditorCard.destroy()}if(this._oPopover){this._oPopover.destroy()}if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy()}this._manifestModel=null;this._originalManifestModel=null;this._settingsModel=null;t.prototype.destroy.apply(this,arguments)};I.prototype._initPreview=function(){return new Promise(function(e,t){sap.ui.require(["sap/ui/integration/designtime/editor/CardPreview"],function(t){var i=new t({settings:this._oDesigntimeInstance.getSettings(),card:this._oEditorCard});this.setAggregation("_preview",i);e()}.bind(this))}.bind(this))};I.prototype._updatePreview=function(){var e=this.getAggregation("_preview");if(e){e.update()}};I.prototype._applyDesigntimeDefaults=function(e){e=e||{};e.form=e.form||{};e.form.items=e.form.items||{};e.preview=e.preview||{modes:"Abstract"};var t=e.form.items||e.form.items;for(var i in t){var a=t[i];if(a.manifestpath){a.value=this._manifestModel.getProperty(a.manifestpath)}if(a.visible===undefined||a.visible===null){a.visible=true}if(typeof a.translatable!=="boolean"){a.translatable=false}if(a.editable===undefined||a.editable===null){a.editable=true}if(!a.label){a.label=i}if(!a.type||a.type==="enum"){a.type="string"}if(a.value===undefined||a.value===null){switch(a.type){case"boolean":a.value=a.defaultValue||false;break;case"integer":case"number":a.value=a.defaultValue||0;break;case"string[]":a.value=a.defaultValue||[];break;default:a.value=a.defaultValue||""}}if(a.type==="group"){if(a.visible===undefined||a.value===null){a.visible=true}}a._settingspath="/form/items/"+i}};I.prototype._applyDesigntimeLayers=function(e){if(this._appliedLayerManifestChanges&&Array.isArray(this._appliedLayerManifestChanges)){for(var t=0;t<this._appliedLayerManifestChanges.length;t++){var i=this._appliedLayerManifestChanges[t][":designtime"];if(i){var a=Object.keys(i);for(var n=0;n<a.length;n++){this._settingsModel.setProperty(a[n],i[a[n]])}}}}if(this._currentLayerManifestChanges){var i=this._currentLayerManifestChanges[":designtime"];if(i){var a=Object.keys(i);for(var n=0;n<a.length;n++){var s=a[n],r=s.substring(0,s.lastIndexOf("/")+1)+"_next";if(!this._settingsModel.getProperty(r)){this._settingsModel.setProperty(r,{})}var r=s.substring(0,s.lastIndexOf("/")+1)+"_next",o=s.substring(s.lastIndexOf("/")+1);this._settingsModel.setProperty(r+"/"+o,i[a[n]])}}}};I.prototype._createParameterDesigntime=function(e){var t={},i="/sap.card/configuration/parameters/",a=this.getMode();if(e&&e.parameters){t.form=t.form||{};t.form.items=t.form.items||{};var s=t.form.items;Object.keys(e.parameters).forEach(function(t){s[t]=n({manifestpath:i+t+"/value",editable:a!=="translation",_settingspath:"/form/items/"+t},e.parameters[t]);var r=s[t];if(!r.type){r.type="string"}if(!r.hasOwnProperty("visible")){r.visible=true}})}return new r(t)};I.prototype._addDestinationSettings=function(e){var t=this._oDesigntimeInstance.getSettings(),i="/sap.card/configuration/destinations/";t.form=t.form||{};t.form.items=t.form.items||{};if(t&&e&&e.destinations){if(!t.form.items["destination.group"]){t.form.items["destination.group"]={label:T.getText("CARDEDITOR_DESTINATIONS")||"Destinations",type:"group",visible:true}}var a=t.form.items;Object.keys(e.destinations).forEach(function(t){var s=[{}],r=this._oEditorCard.getHostInstance();a[t+".destinaton"]=n({manifestpath:i+t+"/name",visible:true,type:"destination",editable:true,allowDynamicValues:false,allowSettings:false,value:e.destinations[t].name,defaultValue:e.destinations[t].defaultUrl,_settingspath:"/form/items/"+[t+".destinaton"],_values:s,_destinationName:t},e.destinations[t]);if(typeof a[t+".destinaton"].label==="undefined"){a[t+".destinaton"].label=t}if(r){a[t+".destinaton"]._loading=true;this._oEditorCard.getHostInstance().getDestinations().then(function(t,i){a[t+".destinaton"]._values=s.concat(i);a[t+".destinaton"]._loading=false;this._settingsModel.checkUpdate(true);a[t+".destinaton"].value=e.destinations[t].name}.bind(this,t))}}.bind(this))}};I.prototype._getManifestDefaultValue=function(e){return this._originalManifestModel.getProperty(e)};I.prototype._isValueWithHandlebarsTranslation=function(e){if(typeof e==="string"){return!!e.match(P)}return false};I._contextEntries={empty:{label:T.getText("CARDEDITOR_CONTEXT_EMPTY_VAL"),type:"string",description:T.getText("CARDEDITOR_CONTEXT_EMPTY_DESC"),placeholder:"",value:""},"card.internal":{label:T.getText("CARDEDITOR_CONTEXT_CARD_INTERNAL_VAL"),todayIso:{type:"string",label:T.getText("CARDEDITOR_CONTEXT_CARD_TODAY_VAL"),description:T.getText("CARDEDITOR_CONTEXT_CARD_TODAY_DESC"),tags:[],placeholder:T.getText("CARDEDITOR_CONTEXT_CARD_TODAY_VAL"),customize:["format.dataTime"],value:"{{parameters.TODAY_ISO}}"},nowIso:{type:"string",label:T.getText("CARDEDITOR_CONTEXT_CARD_NOW_VAL"),description:T.getText("CARDEDITOR_CONTEXT_CARD_NOW_DESC"),tags:[],placeholder:T.getText("CARDEDITOR_CONTEXT_CARD_NOW_VAL"),customize:["dateFormatters"],value:"{{parameters.NOW_ISO}}"},currentLanguage:{type:"string",label:T.getText("CARDEDITOR_CONTEXT_CARD_LANG_VAL"),description:T.getText("CARDEDITOR_CONTEXT_CARD_LANG_VAL"),tags:["technical"],customize:["languageFormatters"],placeholder:T.getText("CARDEDITOR_CONTEXT_CARD_LANG_VAL"),value:"{{parameters.LOCALE}}"}}};I._languages={};I._appendThemeVars=function(){var e=document.getElementById("sap-ui-integration-editor-style");if(e&&e.parentNode){e.parentNode.removeChild(e)}var t=["sapUiButtonHoverBackground","sapUiBaseBG","sapUiContentLabelColor","sapUiTileSeparatorColor","sapUiHighlight","sapUiListSelectionBackgroundColor","sapUiChartScrollbarBorderColor"],i=document.createElement("style");i.setAttribute("id","sap-ui-integration-editor-style");for(var a=0;a<t.length;a++){t[a]="--"+t[a]+":"+b.get(t[a])}i.innerHTML=".sapUiIntegrationCardEditor, .sapUiIntegrationFieldSettings, .sapUiIntegrationIconSelectList {"+t.join(";")+"}";document.body.appendChild(i)};I.init=function(){this.init=function(){};I._appendThemeVars();i.attachThemeChanged(function(){I._appendThemeVars()});var e=sap.ui.require.toUrl("sap.ui.integration.designtime.editor.css.CardEditor".replace(/\./g,"/")+".css");y(e);C.loadResource("sap/ui/integration/designtime/editor/languages.json",{dataType:"json",failOnError:false,async:true}).then(function(e){I._languages=e})};I.init();return I});