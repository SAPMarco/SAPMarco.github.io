/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/editor/fields/BaseField","sap/m/Input","sap/m/Text","sap/m/Select","sap/m/ComboBox","sap/ui/core/ListItem","./viz/IconSelect","sap/base/util/each","sap/base/util/restricted/_debounce"],function(e,t,i,n,a,s,r,l,u){"use strict";var o=e.extend("sap.ui.integration.designtime.editor.fields.StringField",{renderer:e.getMetadata().getRenderer()});o.prototype.initVisualization=function(e){var r=e.visualization;if(!r){if(e.editable){if(e.enum){var l=new s({key:{path:"currentSettings>"},text:{path:"currentSettings>"}});r={type:n,settings:{selectedKey:{path:"currentSettings>value"},forceSelection:false,editable:e.editable,showSecondaryValues:false,width:"100%",items:{path:"currentSettings>enum",template:l}}}}else if(e.values){var l=this.formatListItem(e.values.item);if(!e.values.item.key){e.values.item.key=e.values.item.text}r={type:a,settings:{busy:{path:"currentSettings>_loading"},selectedKey:{path:"currentSettings>value"},editable:e.editable,showSecondaryValues:true,width:"100%",items:{path:"",template:l}}};if(this.isFilterBackend(e)){r.settings.selectedKey={parts:["currentSettings>value","currentSettings>suggestValue"],formatter:function(e,t){if((!e||e==="")&&t){return t}else{return e}}}}}else{r={type:t,settings:{value:{path:"currentSettings>value"},editable:e.editable,placeholder:e.placeholder}}}}else if(this.getMode()==="translation"){r={type:i,settings:{text:{path:"currentSettings>value"},wrapping:false}}}else{r={type:t,settings:{value:{path:"currentSettings>value"},editable:false}}}}this._visualization=r;this.attachAfterInit(this._afterInit)};o.prototype._afterInit=function(){var e=this.getAggregation("_field");if(e instanceof a){var t=this.getConfiguration();if(this.isFilterBackend(t)){this.onInput=u(this.onInput,500);e.oninput=this.onInput;e.attachSelectionChange(this.onSelectionChange)}}};o.prototype.onSelectionChange=function(e){var t=e.getParameter("selectedItem")||{};var i=t.getKey();var n=this.getBindingContext("currentSettings").sPath;var a=this.getModel("currentSettings");a.setProperty(n+"/value",i)};o.prototype.onInput=function(e){var t=e.target.value;var i=this.getBindingContext("currentSettings").sPath;var n=this.getModel("currentSettings");n.setProperty(i+"/suggestValue",t);n.setProperty(i+"/_loading",true);n.setProperty(i+"/value","");var a=n.getBindings();var s=i.substring(i.lastIndexOf("/")+1);l(a,function(e,t){if(t.sPath==="/form/items/"+s+"/value"){t.checkUpdate(true)}});var r=e.srcControl;r.open();r.setValue(t);r.setSelection(null)};return o});