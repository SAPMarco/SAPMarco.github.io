/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/support/supportRules/Storage","sap/ui/support/supportRules/Constants"],function(e,r,t){"use strict";var i={};var s=function(r){r=r||{};if(!r.name){e.sap.log.error("Please provide a name for the RuleSet.")}if(i[r.name]){return i[r.name]}this._oSettings=r;this._mRules={};i[r.name]=this};s.clearAllRuleSets=function(){i={}};s.prototype.getRules=function(){return this._mRules};s.prototype.updateRule=function(e,r){var t=this._verifySettingsObject(r,true);if(t==="success"){delete this._mRules[e];this._mRules[r.id]=r}return t};s.prototype._verifySettingsObject=function(r,t){if(!r.id){e.sap.log.error("Support rule needs an id.");return"Support rule needs an unique id."}if(!t&&this._mRules[r.id]){e.sap.log.error("Support rule with the id "+r.id+" already exists.");return"Support rule with the id "+r.id+" already exists."}if(!r.check){e.sap.log.error("Support rule with the id "+r.id+" needs a check function.");return"Support rule with the id "+r.id+" needs a check function."}if(!r.title){e.sap.log.error("Support rule with the id "+r.id+" needs a title.");return"Support rule with the id "+r.id+" needs a title."}if(!r.description){e.sap.log.error("Support rule with the id "+r.id+" needs a description.");return"Support rule with the id "+r.id+" needs a description."}if(!r.resolution&&(!r.resolutionurls||!r.resolutionurls.length>0)){e.sap.log.error("Support rule with the id "+r.id+" needs either a resolution or resolutionurls or should have a ticket handler function");return"Support rule with the id "+r.id+" needs either a resolution or resolutionurls or should have a ticket handler function"}if(!r.audiences||r.audiences.length===0){e.sap.log.error("Support rule with the id "+r.id+" should have an audience. Applying audience ['Control']");r.audiences=[sap.ui.support.Audiences.Control]}if(r.audiences&&r.audiences.forEach){var i=false,s="";r.audiences.forEach(function(e){if(!sap.ui.support.Audiences[e]){i=true;s=e}});if(i){e.sap.log.error("Audience "+s+" does not exist. Please use the audiences from sap.ui.support.Audiences");return"Audience "+s+" does not exist. Please use the audiences from sap.ui.support.Audiences"}}if(!r.categories||r.categories.length===0){e.sap.log.error("Support rule with the id "+r.id+" should have a category. Applying category ['Performance']");r.categories=["Performance"]}if(r.categories&&r.categories.forEach){var o=false,u="";r.categories.forEach(function(e){if(!sap.ui.support.Categories[e]){o=true;u=e}});if(o){e.sap.log.error("Category "+u+" does not exist. Please use the categories from sap.ui.support.Categories");return"Category "+u+" does not exist. Please use the categories from sap.ui.support.Categories"}}return"success"};s.prototype.addRule=function(r,t){var i=s.versionInfo?s.versionInfo.version:t.version;var o=r.minversion?r.minversion:"";if(o==="-"){o=""}if(o&&e.sap.Version(i).compareTo(o)<0){return"Rule "+r.id+" should be used with a version >= "+r.minversion}var u=this._verifySettingsObject(r);if(u==="success"){this._mRules[r.id]=r;r.libName=this._oSettings.name}return u};s.prototype.removeRule=function(e){if(this._mRules[e.id]){delete this._mRules[e.id]}};s.storeSelectionOfRules=function(e){var t=s._extractRulesSettingsToSave(e);r.setSelectedRules(t)};s.loadSelectionOfRules=function(e){var t=r.getSelectedRules();if(!t){return}for(var i=0;i<e.length;i+=1){var s=e[i].rules;var o=e[i].title;for(var u=0;u<s.length;u+=1){if(t[o]&&t[o].hasOwnProperty(s[u].id)){s[u].selected=t[o][s[u].id].selected}}}};s._extractRulesSettingsToSave=function(e){var r={};var t;var i=e.length;var s;var o;var u;for(var n=0;n<i;n+=1){o=e[n].title;r[o]={};t=e[n].rules;s=t.length;for(var a=0;a<s;a+=1){u={};u.id=t[a].id;u.selected=t[a].selected;r[o][u.id]=u}}return r};return s},true);