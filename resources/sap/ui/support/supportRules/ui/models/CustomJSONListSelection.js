/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./CustomListSelection","sap/ui/support/supportRules/Storage","sap/ui/support/supportRules/ui/models/SelectionUtils","sap/ui/support/supportRules/Constants"],function(e,t,i,n){"use strict";var o=e.extend("sap.ui.support.supportRules.ui.models.CustomJSONListSelection",{constructor:function(t,i,n){e.call(this,t,n);this._dependent=i},_updateModelAfterSelectionChange:function(e){var o=this._getBinding();var s=o.getModel();var r=s.getData();var a=e.getParameter("rowIndices")||[];var l=this._getSelectionModel();var u=this;function d(e,t,i){var n=s.getProperty(e+"/nodes");if(u._isTree()&&u._dependent){if(n&&n.length){for(var o=0;o<n.length;o++){d(e+"/nodes/"+o+"",t,true);u.updateModelAfterChangedSelection(r,e,t)}}else{if(!t&&!i){var a=e.split("/");a.pop();a.pop();var l=a.join("/");u._setSelectionForContext(s,s.createBindingContext(l),t)}}}u.updateModelAfterChangedSelection(r,e,t);u._setSelectionForContext(s,s.createBindingContext(e),t)}for(var p=0;p<a.length;p++){var c=this._getContextByIndex(a[p]);if(c){d(c.getPath(),l.isSelectedIndex(a[p]))}}this.syncParentNoteWithChildrenNotes(r);this._finalizeSelectionUpdate();i.getSelectedRules();if(t.readPersistenceCookie(n.COOKIE_NAME)){i.persistSelection();var f=t.getRules();i.getRulesSelectionState().forEach(function(e){if(e.libName==="temporary"){f.forEach(function(t){if(e.ruleId===t.id){t.selected=e.selected}})}});t.setRules(f)}}});return o});