/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./CreationRowRenderer","./Column","./utils/TableUtils","sap/ui/core/Control","sap/m/library","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button"],function(e,t,r,l,a,i,n,o){"use strict";var s=l.extend("sap.ui.table.CreationRow",{metadata:{library:"sap.ui.table",properties:{applyEnabled:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{cells:{type:"sap.ui.core.Control",multiple:true,singularName:"cell"},toolbar:{type:"sap.ui.core.Toolbar",multiple:false},_defaultToolbar:{type:"sap.ui.core.Toolbar",multiple:false,visibility:"hidden"}},events:{apply:{allowPreventDefault:true}}}});s.prototype.setApplyEnabled=function(e){this.setProperty("applyEnabled",e,true);this._updateDefaultToolbar();return this};s.prototype.setVisible=function(e){var t=this.getVisible();var r=this._getTable();this.setProperty("visible",e);if(t!==e&&r){r.invalidate()}return this};s.prototype.setParent=function(e){l.prototype.setParent.apply(this,arguments);this._update();return this};s.prototype.resetFocus=function(){var e=this._getFirstInteractiveElement();if(e){e.focus();r.selectElementText(e);return true}return false};s.prototype.getFocusDomRef=function(){var e=this._getFirstInteractiveElement();if(e){return e}return l.prototype.getFocusDomRef.apply(this,arguments)};s.prototype._fireApply=function(){var e=false;if(this.fireApply()){e=this.resetFocus()}return e};s.prototype.onsapentermodifiers=function(e){if(this.getApplyEnabled()&&(e.metaKey||e.ctrlKey)){var t=document.activeElement;t.blur();e.setMarked();window.setTimeout(function(){if(!this._fireApply()){t.focus()}}.bind(this),0)}};function u(e){return new i(e.getId()+"-tb",{content:[new n,new o(e.getId()+"-applyBtn",{text:r.getResourceText("TBL_CREATIONROW_APPLY"),enabled:e.getApplyEnabled(),press:function(){e._fireApply()}})],style:a.ToolbarStyle.Clear,ariaLabelledBy:[e.getId()+"-label"]})}s.prototype._getToolbar=function(){var e=this.getToolbar();if(!e){var t=this.getAggregation("_defaultToolbar");if(!t){t=u(this);this.setAggregation("_defaultToolbar",t,true)}e=t;if(e.data("sap-ui-table-invalid")){this._updateDefaultToolbar()}}return e};s.prototype._updateDefaultToolbar=function(){var e=this.getAggregation("_defaultToolbar");var t;if(this.getToolbar()){if(e){e.data("sap-ui-table-invalid",true)}return}if(!e){return}t=e.getContent()[1];t.setEnabled(this.getApplyEnabled());e.data("sap-ui-table-invalid",null)};s.prototype._getFirstInteractiveElement=function(){var e=this.getCells();for(var t=0;t<e.length;t++){var l=e[t].getDomRef();var a=r.getCell(this._getTable(),l,true);var i=r.getInteractiveElements(a);if(i){return i[0]}}return null};s.prototype._getCell=function(e){var r=this.getCells();var l=r.filter(function(r){return t.ofCell(r).getIndex()===e})[0];if(!l){return null}return l};s.prototype._getCellDomRef=function(e){var t=this._getCell(e);var l=t?t.getDomRef():null;var a=r.getCell(this._getTable(),l,true);if(!a){return null}return a};s.prototype._focusCell=function(e){var t=this._getCellDomRef(e);var l=r.getInteractiveElements(t);if(l){l[0].focus();r.selectElementText(l[0]);return true}return false};s.prototype._takeOverKeyboardHandling=function(e){var t=this._getTable();var l=t?t.getDomRef():null;if(!l||!l.contains(document.activeElement)){return false}var a=r.getCell(this._getTable(),document.activeElement);var i=r.getCellInfo(a);var n=false;if(i.columnIndex!=null&&i.columnIndex>=0){n=this._focusCell(i.columnIndex)}else{n=this.resetFocus()}if(n&&e){e.preventDefault()}return n};s.prototype._update=function(){var e=this._getTable();if(!e){this.removeAllCells();return}var t=e.getColumns();this.removeAllCells();for(var r=0,l=t.length;r<l;r++){if(t[r].getVisible()){this.addCell(t[r].getTemplateClone(r,"Creation"))}}};s.prototype._getTable=function(){var e=this.getParent();return r.isA(e,"sap.ui.table.Table")?e:null};return s});