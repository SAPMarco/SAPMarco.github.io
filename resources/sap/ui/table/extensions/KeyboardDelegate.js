/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../utils/TableUtils","../library","sap/ui/base/Object","sap/ui/Device","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery"],function(e,t,i,o,n,s){"use strict";var r=e.CELLTYPE;var l=t.SelectionMode;var a={CTRL:1,SHIFT:2,ALT:4};var f={LEFT:"Left",RIGHT:"Right",UP:"Up",DOWN:"Down"};var u=5;var c="1rem";function g(e,t){e.setMarked("sapUiTableSkipItemNavigation",t!==false)}var v=i.extend("sap.ui.table.extensions.KeyboardDelegate",{constructor:function(e){i.call(this)},destroy:function(){i.prototype.destroy.apply(this,arguments)},getInterface:function(){return this}});v._restoreFocusOnLastFocusedDataCell=function(t,i){var o=e.getFocusedItemInfo(t);var n=t._getKeyboardExtension()._getLastFocusedCellInfo();e.focusItem(t,o.cellInRow+o.columnCount*n.row,i)};v._setFocusOnColumnHeaderOfLastFocusedDataCell=function(t,i){var o=e.getFocusedItemInfo(t);e.focusItem(t,o.cellInRow,i)};v._forwardFocusToTabDummy=function(e,t){e._getKeyboardExtension()._setSilentFocus(e.$().find("."+t))};v._isKeyCombination=function(e,t,i){if(i==null){i=0}var s=typeof t==="string"?String.fromCharCode(e.charCode):e.keyCode;var r=0;r|=(o.os.macintosh?e.metaKey:e.ctrlKey)&&t!==n.CONTROL?a.CTRL:0;r|=e.shiftKey&&t!==n.SHIFT?a.SHIFT:0;r|=e.altKey&&t!==n.ALT?a.ALT:0;var l=t==null||s===t;var f=i===r;return l&&f};v._handleSpaceAndEnter=function(t,i){var o=e.getCellInfo(i.target);if(o.isOfType(r.COLUMNROWHEADER)){t._getSelectionPlugin().onHeaderSelectorPress()}else if(v._isElementGroupToggler(t,i.target)){e.Grouping.toggleGroupHeaderByRef(t,i.target)}else if(o.isOfType(r.ROWHEADER)){l()}else if(o.isOfType(r.DATACELL|r.ROWACTION)){var n=!t.hasListeners("cellClick");if(!t._findAndfireCellEvent(t.fireCellClick,i)){if(e.isRowSelectionAllowed(t)){l();n=false}}if(n){var s=e.getInteractiveElements(i.target);if(s){t._getKeyboardExtension().setActionMode(true)}}}function l(){var o=null;if(t._legacyMultiSelection){o=function(e){t._legacyMultiSelection(e,i);return true}}e.toggleRowSelection(t,i.target,null,o)}};v._moveColumn=function(t,i){var o=t.getParent();var n=o._getVisibleColumns();var s=n.indexOf(t);var r;if(i&&s<n.length-1){r=o.indexOfColumn(n[s+1])+1}else if(!i&&s>0){r=o.indexOfColumn(n[s-1])}if(r!=null){e.Column.moveColumnTo(t,r)}};v._getVisibleAndGroupedColumns=function(e){return e.getColumns().filter(function(e){return e.getVisible()||e.getGrouped()})};v._getColumnIndexInVisibleAndGroupedColumns=function(e,t){var i=v._getVisibleAndGroupedColumns(e);for(var o=0;o<i.length;o++){var n=i[o];if(n===t){return o}}return-1};v._focusElement=function(t,i,o){if(!t||!i){return}if(o==null){o=false}e.deselectElementText(document.activeElement);if(o){t._getKeyboardExtension()._setSilentFocus(i)}else{i.focus()}e.selectElementText(i)};v._focusCell=function(t,i,o,n,s,l){if(!t||i==null||o==null||o<0||o>=t.getRows().length){return}var a=t.getRows()[o];var f;if(i===r.ROWHEADER){t._getKeyboardExtension()._setFocus(t.getDomRef("rowsel"+o));return}else if(i===r.ROWACTION){f=t.getDomRef("rowact"+o)}else if(i===r.DATACELL&&(n!=null&&n>=0)){var u=t.getColumns()[n];var c=v._getColumnIndexInVisibleAndGroupedColumns(t,u);if(c>=0){f=a.getDomRef("col"+c)}}if(!f){return}if(s){var g=e.getInteractiveElements(f);if(g){v._focusElement(t,g[0]);return}}if(l){t._getKeyboardExtension()._bStayInActionMode=true}f.focus()};v._navigate=function(t,i,o){if(i.isMarked()){return}var n=t._getKeyboardExtension();var s=n.isInActionMode();var l=e.getCellInfo(e.getCell(t,i.target));var u=false;if((o===f.UP||o===f.DOWN)&&l.isOfType(r.ANYCONTENTCELL)){var c=v._isKeyCombination(i,null,a.CTRL);var d=c||s;var C=e.getParentCell(t,i.target);var p=s&&l.isOfType(r.DATACELL);if(!c&&(i.target instanceof window.HTMLInputElement||i.target instanceof window.HTMLTextAreaElement)){return}if(!d&&C){C.trigger("focus");return}g(i);if(o===f.UP){if(e.isFirstScrollableRow(t,l.cell)){u=t._getScrollExtension().scrollVertically(false,false,p,function(){if(p){document.activeElement.blur()}})}}else if(e.isLastScrollableRow(t,l.cell)){u=t._getScrollExtension().scrollVertically(true,false,p,function(){if(p){document.activeElement.blur()}})}if(u){i.preventDefault();if(d){t.attachEventOnce("_rowsUpdated",function(){v._focusCell(t,l.type,l.rowIndex,l.columnIndex,true)})}}else if(o===f.UP&&l.rowIndex===0){g(i,l.isOfType(r.ROWACTION)||d);if(!s&&C){C.trigger("focus")}else{n.setActionMode(false)}}else if(o===f.DOWN&&l.rowIndex===t._getRowCounts().count-1){if(!s&&C){C.trigger("focus")}else{var m=t.getCreationRow();if(!m||!m._takeOverKeyboardHandling(i)){n.setActionMode(false)}}}else{var h=o===f.DOWN?1:-1;v._focusCell(t,l.type,l.rowIndex+h,l.columnIndex,d);i.preventDefault()}}else if(o===f.DOWN&&l.isOfType(r.ANYCOLUMNHEADER)){var E=e.getHeaderRowCount(t);if(e.isNoDataVisible(t)){var I=e.getFocusedItemInfo(t);if(I.row-E<=1){g(i)}}else if(l.isOfType(r.COLUMNROWHEADER)&&E>1){g(i);e.focusItem(t,E*(e.getVisibleColumnCount(t)+1),i)}}else if(o===f.LEFT&&!s){var T=sap.ui.getCore().getConfiguration().getRTL();if(l.isOfType(r.COLUMNHEADER)&&T){var y=e.getFocusedItemInfo(t);var R=y.cellInRow-(e.hasRowHeader(t)?1:0);var A=e.getVisibleColumnCount(t);if(e.hasRowActions(t)&&R===A-1){g(i)}}}};v._isElementGroupToggler=function(t,i){return e.Grouping.isInGroupHeaderRow(i)||e.Grouping.isTreeMode(t)&&i.classList.contains("sapUiTableCellFirst")&&(i.querySelector(".sapUiTableTreeIconNodeOpen")||i.querySelector(".sapUiTableTreeIconNodeClosed"))||i.classList.contains("sapUiTableTreeIconNodeOpen")||i.classList.contains("sapUiTableTreeIconNodeClosed")};v._isElementInteractive=function(t){if(!t){return false}return s(t).is(e.INTERACTIVE_ELEMENT_SELECTORS)};v._getFirstInteractiveElement=function(t){if(!t){return null}var i=t.getParent();var o=t.getCells();var n;var s;if(e.hasRowActions(i)){o.push(t.getRowAction())}for(var r=0;r<o.length;r++){n=e.getParentCell(i,o[r].getDomRef());s=e.getInteractiveElements(n);if(s){return s.first()}}return null};v._getLastInteractiveElement=function(t){if(!t){return null}var i=t.getParent();var o=t.getCells();var n;var s;if(e.hasRowActions(i)){o.push(t.getRowAction())}for(var r=o.length-1;r>=0;r--){n=e.getParentCell(i,o[r].getDomRef());s=e.getInteractiveElements(n);if(s){return s.last()}}return null};v._getPreviousInteractiveElement=function(t,i){if(!t||!i){return null}var o=s(i);if(!this._isElementInteractive(o)){return null}var n=e.getParentCell(t,i);var l;var a;var f;var u;var c;var g;var d;l=e.getInteractiveElements(n);if(l[0]!==o[0]){return l.eq(l.index(i)-1)}a=e.getCellInfo(n);u=t.getRows()[a.rowIndex].getCells();if(a.isOfType(r.ROWACTION)){d=u.length-1}else{c=t.getColumns()[a.columnIndex];g=v._getColumnIndexInVisibleAndGroupedColumns(t,c);d=g-1}for(var C=d;C>=0;C--){f=u[C].getDomRef();n=e.getParentCell(t,f);l=e.getInteractiveElements(n);if(l){return l.last()}}return null};v._getNextInteractiveElement=function(t,i){if(!t||!i){return null}var o=s(i);if(!this._isElementInteractive(o)){return null}var n=e.getParentCell(t,i);var l;var a;var f;var u;var c;var g;var d;l=e.getInteractiveElements(n);if(l.get(-1)!==o[0]){return l.eq(l.index(i)+1)}a=e.getCellInfo(n);if(a.isOfType(r.ROWACTION)){return null}g=t.getRows()[a.rowIndex];u=g.getCells();c=t.getColumns()[a.columnIndex];d=v._getColumnIndexInVisibleAndGroupedColumns(t,c);for(var C=d+1;C<u.length;C++){f=u[C].getDomRef();n=e.getParentCell(t,f);l=e.getInteractiveElements(n);if(l){return l.first()}}if(e.hasRowActions(t)){n=e.getParentCell(t,g.getRowAction().getDomRef());l=e.getInteractiveElements(n);if(l.get(-1)!==o[0]){return l.eq(l.index(i)+1)}}return null};function d(t){var i=e.getRowIndexOfFocusedCell(t);var o=t.getRows()[i].getIndex();var n=t._getSelectionPlugin();t._oRangeSelection={startIndex:o,selected:n.isIndexSelected(o)}}v.prototype.enterActionMode=function(){var t=this._getKeyboardExtension();var i=document.activeElement;var o=e.getInteractiveElements(i);var n=e.getParentCell(this,i);var s=e.getCellInfo(n);if(s.isOfType(r.ANYCOLUMNHEADER)){return false}if(o){t._suspendItemNavigation();i.tabIndex=-1;v._focusElement(this,o[0],true);return true}else if(n){this._getKeyboardExtension()._suspendItemNavigation();return true}return false};v.prototype.leaveActionMode=function(t){t=t==null?true:t;var i=this._getKeyboardExtension();var o=document.activeElement;var n=e.getParentCell(this,o);i._resumeItemNavigation();if(t){if(n){v._focusElement(this,n[0],true)}else{var s=this._getItemNavigation();if(s){var r=s.aItemDomRefs;var l=r.indexOf(o);if(l>-1){s.setFocusedIndex(l)}}i._setSilentFocus(o)}}};v.prototype.onfocusin=function(t){if(t.isMarked("sapUiTableIgnoreFocusIn")){return}var i=s(t.target);if(i.hasClass("sapUiTableOuterBefore")||i.hasClass("sapUiTableOuterAfter")||t.target!=this.getDomRef("overlay")&&this.getShowOverlay()){this.$("overlay").trigger("focus")}else if(i.hasClass("sapUiTableCtrlBefore")){var o=e.isNoDataVisible(this);if(!o||o&&this.getColumnHeaderVisible()){v._setFocusOnColumnHeaderOfLastFocusedDataCell(this,t)}else{this._getKeyboardExtension()._setSilentFocus(this.$("noDataCnt"))}}else if(i.hasClass("sapUiTableCtrlAfter")){if(!e.isNoDataVisible(this)){v._restoreFocusOnLastFocusedDataCell(this,t)}}var n=e.getCellInfo(t.target);var l=n.isOfType(r.ROWHEADER)&&e.Grouping.isInGroupHeaderRow(t.target);var a=n.isOfType(r.ROWHEADER)&&!l&&e.isRowSelectorSelectionAllowed(this);var f=n.isOfType(r.DATACELL)&&this._getKeyboardExtension()._bStayInActionMode;var u=e.getCellInfo(e.getParentCell(this,t.target)).isOfType(r.ANYCONTENTCELL);var c=v._isElementInteractive(t.target);var g=this._getKeyboardExtension().isInActionMode();var d=g&&(l||a||f)||c&&u;if(f){this._getKeyboardExtension()._bStayInActionMode=false}this._getKeyboardExtension().setActionMode(d,false)};v.prototype.onkeydown=function(t){var i=this._getKeyboardExtension();var s=e.getCellInfo(t.target);var f=this.getSelectionMode();var u=this._getSelectionPlugin();if(o.browser.msie&&v._isKeyCombination(t,n.V,a.CTRL)){this.onpaste(t);return}if(v._isKeyCombination(t,n.F2)){var c=i.isInActionMode();var g=e.getCell(this,t.target);var C=e.getParentCell(this,t.target)!=null;s=e.getCellInfo(g);if(!c&&C){g.trigger("focus")}else if(s.isOfType(r.ANYCOLUMNHEADER)){var p=e.getInteractiveElements(g);if(p){p[0].focus()}}else{i.setActionMode(!c)}return}else if(v._isKeyCombination(t,n.F4)&&v._isElementGroupToggler(this,t.target)){e.Grouping.toggleGroupHeaderByRef(this,t.target);return}if(this._getKeyboardExtension().isInActionMode()||!s.isOfType(r.ANY)){return}if(v._isKeyCombination(t,n.SPACE)){t.preventDefault()}if(v._isKeyCombination(t,n.SHIFT)&&f===l.MultiToggle&&(s.isOfType(r.ROWHEADER)&&e.isRowSelectorSelectionAllowed(this)||s.isOfType(r.DATACELL|r.ROWACTION))){d(this)}else if(v._isKeyCombination(t,n.A,a.CTRL)){t.preventDefault();if(s.isOfType(r.ANYCONTENTCELL|r.COLUMNROWHEADER)&&f===l.MultiToggle){u.onKeyboardShortcut("toggle")}}else if(v._isKeyCombination(t,n.A,a.CTRL+a.SHIFT)){if(s.isOfType(r.ANYCONTENTCELL|r.COLUMNROWHEADER)){u.onKeyboardShortcut("clear")}}else if(v._isKeyCombination(t,n.F4)){if(s.isOfType(r.DATACELL)){i.setActionMode(true)}}};v.prototype.onkeypress=function(t){var i=this._getKeyboardExtension();var o=e.getCellInfo(t.target);if(v._isKeyCombination(t,"+")){if(v._isElementGroupToggler(this,t.target)){e.Grouping.toggleGroupHeaderByRef(this,t.target,true)}else if(o.isOfType(r.DATACELL|r.ROWACTION)){i.setActionMode(true)}}else if(v._isKeyCombination(t,"-")){if(v._isElementGroupToggler(this,t.target)){e.Grouping.toggleGroupHeaderByRef(this,t.target,false)}else if(o.isOfType(r.DATACELL|r.ROWACTION)){i.setActionMode(true)}}};v.prototype.oncontextmenu=function(t){if(t.isMarked("handledByPointerExtension")){return}var i=e.getCellInfo(document.activeElement);if(i.isOfType(r.ANY)){t.preventDefault();e.Menu.openContextMenu(this,t.target,t)}};v.prototype.onkeyup=function(t){var i=e.getCellInfo(t.target);if(v._isKeyCombination(t,n.SHIFT)){delete this._oRangeSelection}if(i.isOfType(r.COLUMNHEADER)){if(v._isKeyCombination(t,n.SPACE)||v._isKeyCombination(t,n.ENTER)){e.Menu.openContextMenu(this,t.target)}}else if(v._isKeyCombination(t,n.SPACE)){v._handleSpaceAndEnter(this,t)}else if(v._isKeyCombination(t,n.SPACE,a.SHIFT)){e.toggleRowSelection(this,this.getRows()[i.rowIndex].getIndex());d(this)}else if(this._legacyMultiSelection&&!i.isOfType(r.COLUMNROWHEADER)&&(v._isKeyCombination(t,n.SPACE,a.CTRL)||v._isKeyCombination(t,n.ENTER,a.CTRL))){v._handleSpaceAndEnter(this,t)}};v.prototype.onsaptabnext=function(t){var i=this._getKeyboardExtension();var o=e.getCellInfo(t.target);var n;if(i.isInActionMode()){var s;n=e.getCell(this,t.target);o=e.getCellInfo(n);if(!o.isOfType(r.ANYCONTENTCELL)){return}var l=this.getRows()[o.rowIndex];var a=v._getLastInteractiveElement(l);var f=a===null||a[0]===t.target;if(f){var u=l.getIndex();var c=e.isLastScrollableRow(this,n);var g=this._getTotalRowCount()-1===u;var d=e.isRowSelectorSelectionAllowed(this);t.preventDefault();if(g){i.setActionMode(false)}else if(c){C(this,o,d,o.rowIndex,l)}else{var p=o.rowIndex;if(d){v._focusCell(this,r.ROWHEADER,p+1)}else{var m=this._getRowCounts().count;var h=false;for(var E=o.rowIndex+1;E<m;E++){p=E;l=this.getRows()[p];s=v._getFirstInteractiveElement(l);h=l.isGroupHeader();if(s||h){break}}if(s){v._focusElement(this,s[0])}else if(h){v._focusCell(this,r.ROWHEADER,p)}else{C(this,o,d,p,l)}}}}else if(o.isOfType(r.ROWHEADER)){t.preventDefault();s=v._getFirstInteractiveElement(l);v._focusElement(this,s[0])}else{t.preventDefault();s=v._getNextInteractiveElement(this,t.target);v._focusElement(this,s[0])}}else if(o.isOfType(r.ANYCOLUMNHEADER)){if(e.isNoDataVisible(this)){this.$("noDataCnt").trigger("focus")}else{v._restoreFocusOnLastFocusedDataCell(this,t)}t.preventDefault()}else if(o.isOfType(r.ANYCONTENTCELL)){v._forwardFocusToTabDummy(this,"sapUiTableCtrlAfter")}else if(t.target===this.getDomRef("overlay")){i._setSilentFocus(this.$().find(".sapUiTableOuterAfter"))}else if(!o.isOfType(r.ANY)){n=e.getParentCell(this,t.target);if(n){t.preventDefault();n.trigger("focus")}}};function C(e,t,i,o,n){var s=t.isOfType(r.DATACELL);var l=e._getKeyboardExtension();var a=e._getScrollExtension().scrollVertically(true,false,s,function(){if(s){document.activeElement.blur()}});if(a){e.attachEventOnce("_rowsUpdated",function(){p(e,n,o,i,n.isGroupHeader())})}else if(n.getIndex()!==e._getTotalRowCount()-1){var f=t.rowIndex+1;var u=e.getRows()[f];p(e,u,f,i,u.isGroupHeader())}else{l.setActionMode(false)}}function p(e,t,i,o,n){var s=e._getKeyboardExtension();if(o||n){v._focusCell(e,r.ROWHEADER,i)}else{var l=v._getFirstInteractiveElement(t);if(l){v._focusElement(e,l[0])}else{v._focusCell(e,r.DATACELL,i,0,false,true);if(t.getIndex()===e._getTotalRowCount()-1){s.setActionMode(false)}}}}v.prototype.onsaptabprevious=function(t){var i=this._getKeyboardExtension();var o=e.getCellInfo(t.target);var n;if(i.isInActionMode()){var s;n=e.getCell(this,t.target);o=e.getCellInfo(n);if(!o.isOfType(r.ANYCONTENTCELL)){return}var l=this.getRows()[o.rowIndex];var a=l.getIndex();var f=v._getFirstInteractiveElement(l);var u=f!==null&&f[0]===t.target;var c=e.isRowSelectorSelectionAllowed(this);var g=c||l.isGroupHeader();if(u&&g){t.preventDefault();v._focusCell(this,r.ROWHEADER,o.rowIndex)}else if(u&&!g||o.isOfType(r.ROWHEADER)||f===null){var d=e.isFirstScrollableRow(this,n);var C=a===0;t.preventDefault();if(C){i.setActionMode(false)}else if(d){m(this,o,g,o.rowIndex,l)}else{var p=o.rowIndex;var h=false;for(var E=o.rowIndex-1;E>=0;E--){p=E;l=this.getRows()[p];s=v._getLastInteractiveElement(l);h=l.isGroupHeader();if(s||g||h){break}}if(s){v._focusElement(this,s[0])}else if(h||g){v._focusCell(this,r.ROWHEADER,p)}else{m(this,o,g,p,l)}}}else{t.preventDefault();s=v._getPreviousInteractiveElement(this,t.target);v._focusElement(this,s[0])}}else if(o.isOfType(r.ANYCONTENTCELL)||t.target===this.getDomRef("noDataCnt")){if(this.getColumnHeaderVisible()&&!o.isOfType(r.ROWACTION)){v._setFocusOnColumnHeaderOfLastFocusedDataCell(this,t);t.preventDefault()}else{v._forwardFocusToTabDummy(this,"sapUiTableCtrlBefore")}}else if(t.target===this.getDomRef("overlay")){this._getKeyboardExtension()._setSilentFocus(this.$().find(".sapUiTableOuterBefore"))}else if(!o.isOfType(r.ANY)){n=e.getParentCell(this,t.target);if(n){t.preventDefault();n.trigger("focus")}}};function m(e,t,i,o,n){var s=t.isOfType(r.DATACELL);var l=e._getKeyboardExtension();var a=e._getScrollExtension().scrollVertically(false,false,s,function(){if(s){document.activeElement.blur()}});if(a){e.attachEventOnce("_rowsUpdated",function(){h(e,n,o,i,n.isGroupHeader())})}else if(n.getIndex()!==0){var f=t.rowIndex-1;var u=e.getRows()[f];h(e,u,f,i,u.isGroupHeader())}else{l.setActionMode(false)}}function h(e,t,i,o,n){var s=e._getKeyboardExtension();var l=v._getLastInteractiveElement(t);if(l){v._focusElement(e,l[0])}else if(o||n){v._focusCell(e,r.ROWHEADER,i)}else{v._focusCell(e,r.DATACELL,i,0,false,true);if(t.getIndex()===0){s.setActionMode(false)}}}v.prototype.onsapdown=function(e){v._navigate(this,e,f.DOWN)};v.prototype.onsapdownmodifiers=function(t){if(v._isKeyCombination(t,null,a.CTRL)){v._navigate(this,t,f.DOWN);return}var i=this._getKeyboardExtension();if(v._isKeyCombination(t,null,a.ALT)&&v._isElementGroupToggler(this,t.target)){g(t);e.Grouping.toggleGroupHeaderByRef(this,t.target,true);return}if(i.isInActionMode()){return}var o=e.getCellInfo(t.target);if(v._isKeyCombination(t,null,a.SHIFT)){t.preventDefault();if(o.isOfType(r.ANYCONTENTCELL)){if(!this._oRangeSelection){g(t);return}var n=e.getRowIndexOfFocusedCell(this);var s=this.getRows()[n].getIndex();if(s===this._getTotalRowCount()-1){return}if(e.isLastScrollableRow(this,t.target)){var l=this._getScrollExtension().scrollVertically(true,false);if(l){g(t)}}if(this._oRangeSelection.startIndex<=s){s++;if(this._oRangeSelection.selected){e.toggleRowSelection(this,s,true)}else{e.toggleRowSelection(this,s,false)}}else{e.toggleRowSelection(this,s,false)}}else{g(t)}}if(v._isKeyCombination(t,null,a.ALT)){if(o.isOfType(r.DATACELL)){i.setActionMode(true)}g(t)}};v.prototype.onsapup=function(e){v._navigate(this,e,f.UP)};v.prototype.onsapupmodifiers=function(t){var i=this._getKeyboardExtension();if(v._isKeyCombination(t,null,a.CTRL)){v._navigate(this,t,f.UP);return}if(v._isKeyCombination(t,null,a.ALT)&&v._isElementGroupToggler(this,t.target)){g(t);e.Grouping.toggleGroupHeaderByRef(this,t.target,false);return}if(i.isInActionMode()){return}var o=e.getCellInfo(t.target);if(v._isKeyCombination(t,null,a.SHIFT)){t.preventDefault();if(o.isOfType(r.ANYCONTENTCELL)){if(!this._oRangeSelection){g(t);return}var n=e.getRowIndexOfFocusedCell(this);var s=this.getRows()[n].getIndex();if(s===0){g(t);return}if(e.isFirstScrollableRow(this,t.target)){var l=this._getScrollExtension().scrollVertically(false,false);if(l){g(t)}}if(this._oRangeSelection.startIndex>=s){s--;if(this._oRangeSelection.selected){e.toggleRowSelection(this,s,true)}else{e.toggleRowSelection(this,s,false)}}else{e.toggleRowSelection(this,s,false)}}else{g(t)}}if(v._isKeyCombination(t,null,a.ALT)){if(o.isOfType(r.DATACELL)){i.setActionMode(true)}g(t)}};v.prototype.onsapleft=function(e){v._navigate(this,e,f.LEFT)};v.prototype.onsapleftmodifiers=function(t){if(this._getKeyboardExtension().isInActionMode()){return}var i=e.getCellInfo(t.target);var o=sap.ui.getCore().getConfiguration().getRTL();if(v._isKeyCombination(t,null,a.SHIFT)){t.preventDefault();if(i.isOfType(r.DATACELL)){if(!this._oRangeSelection){g(t);return}var n=e.getFocusedItemInfo(this);var s=e.hasRowHeader(this)&&n.cellInRow===1;if(s&&!e.isRowSelectorSelectionAllowed(this)){g(t)}}else if(i.isOfType(r.ROWACTION)){if(!this._oRangeSelection){g(t)}}else if(i.isOfType(r.ROWHEADER)&&o){if(!e.isRowSelectionAllowed(this)){g(t)}}else if(i.isOfType(r.COLUMNROWHEADER)&&o){g(t)}else if(i.isOfType(r.COLUMNHEADER)){var l=-e.convertCSSSizeToPixel(c);var f=0;if(o){l=l*-1}for(var u=i.columnIndex;u<i.columnIndex+i.columnSpan;u++){f+=e.Column.getColumnWidth(this,u)}e.Column.resizeColumn(this,i.columnIndex,f+l,true,i.columnSpan);g(t)}}else if(v._isKeyCombination(t,null,a.CTRL)){if(i.isOfType(r.COLUMNHEADER)){t.preventDefault();t.stopImmediatePropagation();var d=this.getColumns()[i.columnIndex];v._moveColumn(d,o)}}};v.prototype.onsaprightmodifiers=function(t){if(this._getKeyboardExtension().isInActionMode()){return}var i=e.getCellInfo(t.target);var o=sap.ui.getCore().getConfiguration().getRTL();if(v._isKeyCombination(t,null,a.SHIFT)){t.preventDefault();if(i.isOfType(r.DATACELL)){if(!this._oRangeSelection){g(t)}}else if(i.isOfType(r.ROWHEADER)){if(!e.isRowSelectionAllowed(this)){g(t)}}else if(i.isOfType(r.ROWACTION)&&o){if(!this._oRangeSelection){g(t)}}else if(i.isOfType(r.COLUMNHEADER)){var n=e.convertCSSSizeToPixel(c);var s=0;if(o){n=n*-1}for(var l=i.columnIndex;l<i.columnIndex+i.columnSpan;l++){s+=e.Column.getColumnWidth(this,l)}e.Column.resizeColumn(this,i.columnIndex,s+n,true,i.columnSpan);g(t)}else if(i.isOfType(r.COLUMNROWHEADER)){g(t)}}else if(v._isKeyCombination(t,null,a.CTRL)){if(i.isOfType(r.COLUMNHEADER)){t.preventDefault();t.stopImmediatePropagation();var f=this.getColumns()[i.columnIndex];v._moveColumn(f,!o)}}};v.prototype.onsaphome=function(t){if(this._getKeyboardExtension().isInActionMode()){return}if(e.Grouping.isInGroupHeaderRow(t.target)){g(t);t.preventDefault();return}var i=e.getCellInfo(t.target);if(i.isOfType(r.ANY)){t.preventDefault()}if(i.isOfType(r.DATACELL|r.ROWACTION|r.COLUMNHEADER)){var o=e.getFocusedItemInfo(this);var n=o.cell;var s=o.cellInRow;var l=this.getComputedFixedColumnCount();var a=e.hasRowHeader(this);var f=a?1:0;if(e.hasFixedColumns(this)&&s>l+f){g(t);e.focusItem(this,n-s+l+f,null)}else if(a&&s>1){g(t);e.focusItem(this,n-s+f,null)}}};v.prototype.onsapend=function(t){if(this._getKeyboardExtension().isInActionMode()){return}if(e.Grouping.isInGroupHeaderRow(t.target)){t.preventDefault();g(t);return}var i=e.getCellInfo(t.target);if(i.isOfType(r.ANY)){t.preventDefault();var o=e.getFocusedItemInfo(this);var n=o.cell;var s=o.columnCount;var l=this.getComputedFixedColumnCount();var a=o.cellInRow;var f=e.hasRowHeader(this);var u=f?1:0;var c=false;if(i.isOfType(r.COLUMNHEADER)&&e.hasFixedColumns(this)){var v=parseInt(i.cell.attr("colspan")||1);if(v>1&&a+v-u===l){c=true}}if(f&&a===0){g(t);e.focusItem(this,n+1,null)}else if(e.hasFixedColumns(this)&&a<l-1+u&&!c){g(t);e.focusItem(this,n+l-a,null)}else if(e.hasRowActions(this)&&i.isOfType(r.DATACELL)&&a<s-2){g(t);e.focusItem(this,n-a+s-2,null)}}};v.prototype.onsaphomemodifiers=function(t){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(t,null,a.CTRL)){t.preventDefault();var i=e.getCellInfo(t.target);if(i.isOfType(r.ANYCONTENTCELL|r.COLUMNHEADER)){g(t);var o=e.getFocusedItemInfo(this);var n=o.row;if(n>0){var s=o.cell;var l=o.columnCount;var f=e.getHeaderRowCount(this);var u=this._getRowCounts();if(n<f+u.fixedTop){if(i.isOfType(r.ROWACTION)){e.focusItem(this,s-l*(n-f),t)}else{e.focusItem(this,s-l*n,t)}}else if(n>=f+u.fixedTop&&n<f+e.getNonEmptyVisibleRowCount(this)-u.fixedBottom){this._getScrollExtension().scrollVerticallyMax(false);if(u.fixedTop>0||i.isOfType(r.ROWACTION)){e.focusItem(this,s-l*(n-f),t)}else{e.focusItem(this,s-l*n,t)}}else{this._getScrollExtension().scrollVerticallyMax(false);e.focusItem(this,s-l*(n-f-u.fixedTop),t)}}}}};v.prototype.onsapendmodifiers=function(t){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(t,null,a.CTRL)){t.preventDefault();var i=e.getCellInfo(t.target);if(i.isOfType(r.ANY)){var o=e.getFocusedItemInfo(this);var n=o.row;var s=e.getHeaderRowCount(this);var l=e.getNonEmptyVisibleRowCount(this);var f=this._getRowCounts();g(t);if(f.fixedBottom===0||n<s+l-1||e.isNoDataVisible(this)&&n<s-1){var u=o.cell;var c=o.columnCount;if(e.isNoDataVisible(this)){e.focusItem(this,u+c*(s-n-1),t)}else if(n<s){if(f.fixedTop>0){e.focusItem(this,u+c*(s+f.fixedTop-n-1),t)}else{this._getScrollExtension().scrollVerticallyMax(true);e.focusItem(this,u+c*(s+l-f.fixedBottom-n-1),t)}}else if(n>=s&&n<s+f.fixedTop){this._getScrollExtension().scrollVerticallyMax(true);e.focusItem(this,u+c*(s+l-f.fixedBottom-n-1),t)}else if(n>=s+f.fixedTop&&n<s+l-f.fixedBottom){this._getScrollExtension().scrollVerticallyMax(true);e.focusItem(this,u+c*(s+l-n-1),t)}else{e.focusItem(this,u+c*(s+l-n-1),t)}}}}};v.prototype.onsappageup=function(t){if(this._getKeyboardExtension().isInActionMode()){return}t.preventDefault();var i=e.getCellInfo(t.target);if(i.isOfType(r.ANYCONTENTCELL|r.COLUMNHEADER)){var o=e.getFocusedItemInfo(this);var n=o.row;var s=e.getHeaderRowCount(this);var l=this._getRowCounts();if(l.fixedTop===0&&n>=s||l.fixedTop>0&&n>s){g(t);var a=o.cell;var f=o.columnCount;if(n<s+l.fixedTop){e.focusItem(this,a-f*(n-s),t)}else if(n===s+l.fixedTop){var u=e.getNonEmptyVisibleRowCount(this)-l.fixedTop-l.fixedBottom;var c=this.getFirstVisibleRow();this._getScrollExtension().scrollVertically(false,true);if(c<u){if(l.fixedTop>0||i.isOfType(r.ROWACTION)){e.focusItem(this,a-f*(n-s),t)}else{e.focusItem(this,a-f*s,t)}}}else if(n>s+l.fixedTop&&n<s+e.getNonEmptyVisibleRowCount(this)){e.focusItem(this,a-f*(n-s-l.fixedTop),t)}else{e.focusItem(this,a-f*(n-s-e.getNonEmptyVisibleRowCount(this)+1),t)}}if(i.isOfType(r.ROWACTION)&&n===s&&l.fixedTop>0){g(t)}}};v.prototype.onsappagedown=function(t){if(this._getKeyboardExtension().isInActionMode()){return}t.preventDefault();var i=e.getCellInfo(t.target);if(i.isOfType(r.ANY)){var o=e.getFocusedItemInfo(this);var n=o.row;var s=e.getHeaderRowCount(this);var l=e.getNonEmptyVisibleRowCount(this);var a=this._getRowCounts();g(t);if(e.isNoDataVisible(this)&&n<s-1||a.fixedBottom===0||n<s+l-1){var f=o.cell;var u=o.columnCount;if(n<s-1&&!i.isOfType(r.COLUMNROWHEADER)){e.focusItem(this,f+u*(s-n-1),t)}else if(n<s){if(!e.isNoDataVisible(this)){e.focusItem(this,f+u*(s-n),t)}}else if(n>=s&&n<s+l-a.fixedBottom-1){e.focusItem(this,f+u*(s+l-a.fixedBottom-n-1),t)}else if(n===s+l-a.fixedBottom-1){var c=e.getNonEmptyVisibleRowCount(this)-a.fixedTop-a.fixedBottom;var v=this._getTotalRowCount()-a.fixedBottom-this.getFirstVisibleRow()-c*2;this._getScrollExtension().scrollVertically(true,true);if(v<c&&a.fixedBottom>0){e.focusItem(this,f+u*(s+l-n-1),t)}}else{e.focusItem(this,f+u*(s+l-n-1),t)}}}};v.prototype.onsappageupmodifiers=function(t){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(t,null,a.ALT)){var i=e.getCellInfo(t.target);var o=e.getFocusedItemInfo(this);if(i.isOfType(r.DATACELL|r.COLUMNHEADER)){var n=o.cell;var s=o.cellInRow;var l=e.hasRowHeader(this);var f=l?1:0;var c=u;g(t);if(l&&(e.Grouping.isInGroupHeaderRow(t.target)||s===1)){e.focusItem(this,n-s,null)}else if(s-f<c){e.focusItem(this,n-s+f,null)}else{e.focusItem(this,n-c,null)}}else if(i.isOfType(r.ROWACTION)){e.focusItem(this,o.cell-1,null)}}};v.prototype.onsappagedownmodifiers=function(t){if(this._getKeyboardExtension().isInActionMode()){return}if(v._isKeyCombination(t,null,a.ALT)){var i=e.getCellInfo(t.target);if(i.isOfType(r.DATACELL|r.ROWHEADER|r.ANYCOLUMNHEADER)){var o=e.getFocusedItemInfo(this);var n=o.cellInRow;var s=e.hasRowHeader(this);var l=s?1:0;var f=e.getVisibleColumnCount(this);var c=parseInt(i.cell.attr("colspan")||1);g(t);if(n+c-l<f){var d=o.cell;var C=u;if(s&&n===0){e.focusItem(this,d+1,null)}else if(c>C){e.focusItem(this,d+c,null)}else if(n+c-l+C>f){e.focusItem(this,d+f-n-1+l,null)}else if(!e.Grouping.isInGroupHeaderRow(t.target)){e.focusItem(this,d+C,null)}}else if(i.isOfType(r.DATACELL)&&e.hasRowActions(this)&&n===o.columnCount-2){e.focusItem(this,o.cell+1,null)}}}};v.prototype.onsapenter=function(e){v._handleSpaceAndEnter(this,e)};return v});