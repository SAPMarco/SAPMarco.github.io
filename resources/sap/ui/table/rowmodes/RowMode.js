/*
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../library","../utils/TableUtils","sap/ui/core/Element","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,o,r,n){"use strict";var i=o.extend("sap.ui.table.rowmodes.RowMode",{metadata:{library:"sap.ui.table",abstract:true,properties:{rowCount:{type:"int",defaultValue:10,group:"Appearance"},fixedTopRowCount:{type:"int",defaultValue:0,group:"Appearance"},fixedBottomRowCount:{type:"int",defaultValue:0,group:"Appearance"}}}});var a={};i.prototype.init=function(){this._bFiredRowsUpdatedAfterRendering=false;this._bListeningForFirstRowsUpdatedAfterRendering=false;this.updateTableAsync=t.throttle(this.updateTable,{wait:50,asyncLeading:true})};i.prototype.exit=function(){this.detachEvents();this.cancelAsyncOperations();this.deregisterHooks()};i.prototype.setParent=function(){this.detachEvents();this.cancelAsyncOperations();this.deregisterHooks();o.prototype.setParent.apply(this,arguments);this.attachEvents();this.registerHooks()};i.prototype.attachEvents=function(){t.addDelegate(this.getTable(),a,this)};i.prototype.detachEvents=function(){t.removeDelegate(this.getTable(),a)};i.prototype.cancelAsyncOperations=function(){var e=this.getTable();if(e){clearTimeout(e._mTimeouts.refreshRowsCreateRows)}this.updateTableAsync.cancel()};i.prototype.registerHooks=function(){var e=this.getTable();var o=t.Hook.Keys;t.Hook.register(e,o.Table.RowsUnbound,this._onTableRowsUnbound,this);t.Hook.register(e,o.Table.UpdateRows,this._onTableUpdateRows,this)};i.prototype.deregisterHooks=function(){var e=this.getTable();var o=t.Hook.Keys;t.Hook.deregister(e,o.Table.RowsUnbound,this._onTableRowsUnbound,this);t.Hook.deregister(e,o.Table.UpdateRows,this._onTableUpdateRows,this)};i.prototype.getMinRequestLength=function(){throw new Error(this.getMetadata().getName()+": sap.ui.table.rowmodes.RowMode subclass did not implement #getMinRequestLength")};i.prototype.getComputedRowCounts=function(){throw new Error(this.getMetadata().getName()+": sap.ui.table.rowmodes.RowMode subclass did not implement #getComputedRowCounts")};i.prototype.getTableStyles=function(){throw new Error(this.getMetadata().getName()+": sap.ui.table.rowmodes.RowMode subclass did not implement #getTableStyles")};i.prototype.getTableBottomPlaceholderStyles=function(){throw new Error(this.getMetadata().getName()+": sap.ui.table.rowmodes.RowMode subclass did not implement #getTableBottomPlaceholderStyles")};i.prototype.getRowContainerStyles=function(){throw new Error(this.getMetadata().getName()+": sap.ui.table.rowmodes.RowMode subclass did not implement #getRowContainerStyles")};i.prototype.getTable=function(){var e=this.getParent();return t.isA(e,"sap.ui.table.Table")?e:null};i.prototype.updateTable=function(e){var t=this.getTable();if(!t){return}this.updateTableAsync.cancel();var o=this.updateTableRows();if(t._bInvalid){return}this.applyTableStyles();this.applyRowContainerStyles();this.applyTableBottomPlaceholderStyles();if(o||t.getRows().some(function(e){return e.getDomRef()==null})){this.renderTableRows()}if(o||t.getRows().length>0){this.fireRowsUpdated(e)}};i.prototype.getBaseRowContentHeight=function(){return 0};i.prototype.getBaseRowHeightOfTable=function(){var e=this.getTable();return e?e._getBaseRowHeight():0};i.prototype.getDefaultRowContentHeightOfTable=function(){var e=this.getTable();return e?e._getDefaultRowContentHeight():0};i.prototype.getTotalRowCountOfTable=function(){var e=this.getTable();return e?e._getTotalRowCount():0};i.prototype._onTableRowsUnbound=function(){clearTimeout(this.getTable()._mTimeouts.refreshRowsCreateRows);this.updateTable(t.RowsUpdateReason.Unbind)};i.prototype._onTableUpdateRows=function(e){var t=this.getTable();clearTimeout(t._mTimeouts.refreshRowsCreateRows);if(!t._bBindingReady){var o=this.getRowContexts(null,true);if(this.getTotalRowCountOfTable()===0&&o.length===1){var r=o[0];var n=t._getRowClone("Virtual");var i=t.getBindingInfo("rows");var a=i?i.model:undefined;n.setBindingContext(r,a);t.addAggregation("rows",n,true);t.removeAggregation("rows",n,true);n.setBindingContext(null,a);n.destroy()}return}this.updateTableAsync(e)};i.prototype.applyTableStyles=function(e){var t=this.getTableStyles();if(e){e.style("height",t.height);e.style("min-height",t.minHeight);e.style("max-height",t.maxHeight);return}var o=this.getTable();var r=o?o.getDomRef():null;if(r){r.style.height=t.height;r.style.minHeight=t.minHeight;r.style.maxHeight=t.maxHeight}};i.prototype.applyTableBottomPlaceholderStyles=function(e){var t=this.getTableBottomPlaceholderStyles();if(e){e.style("height",t.height);return}var o=this.getTable();var r=o?o.getDomRef("placeholder-bottom"):null;if(r){r.style.height=t.height}};i.prototype.applyRowContainerStyles=function(e){var t=this.getRowContainerStyles();if(e){e.style("height",t.height);e.style("min-height",t.minHeight);e.style("max-height",t.maxHeight);return}var o=this.getTable();var r=o?o.getDomRef("tableCCnt"):null;if(r){r.style.height=t.height;r.style.minHeight=t.minHeight;r.style.maxHeight=t.maxHeight}};i.prototype.sanitizeRowCounts=function(e,t,o){e=Math.max(0,e);t=Math.max(0,t);o=Math.max(0,o);if(t+o>=e){o=Math.max(0,o-Math.max(0,t+o-(e-1)));t=Math.max(0,t-Math.max(0,t+o-(e-1)))}return{count:e,scrollable:e-t-o,fixedTop:t,fixedBottom:o}};i.prototype.renderRowStyles=function(e){};i.prototype.renderCellContentStyles=function(e){};i.prototype.initTableRowsAfterDataRequested=function(e){var t=this.getTable();var o=t.getBinding("rows");clearTimeout(t._mTimeouts.refreshRowsCreateRows);if(!o||e<=0||t.getRows().length>0){return}o.attachEventOnce("dataRequested",function(){clearTimeout(t._mTimeouts.refreshRowsCreateRows);t._mTimeouts.refreshRowsCreateRows=setTimeout(function(){if(t.getRows().length>0){return}var o=s(t,e),r;for(var n=0;n<o.length;n++){r=o[n];r.setRowBindingContext(null,t);t.addAggregation("rows",r,true)}t._bRowAggregationInvalid=false},0)})};i.prototype.updateTableRows=function(){var e=this.getTable();var o=e.getRows();var r=this.getComputedRowCounts().count;var n;var i=false;if(t.isNoDataVisible(e)&&!e.getBinding("rows")){r=0}else if(t.isVariableRowHeightEnabled(e)){r=r+1}if(e._bRowAggregationInvalid){i=o.length>0;e.destroyAggregation("rows",e._bInvalid?"KeepDom":true);o=[]}if(r===o.length){l(this,o);return i}t.dynamicCall(e._getSyncExtension,function(e){e.syncRowCount(r)});if(o.length<r){var a=s(e,r-o.length);o=o.concat(a);l(this,o);for(n=0;n<a.length;n++){e.addAggregation("rows",a[n],true)}}else{for(n=o.length-1;n>=r;n--){e.removeAggregation("rows",n,true)}o.splice(r);l(this,o)}i=true;e._bRowAggregationInvalid=false;return i};i.prototype.renderTableRows=function(){var e=this.getTable();var t=e?e.getDomRef("tableCCnt"):null;if(!t){return}var o=n.Event("BeforeRendering");o.setMarked("renderRows");o.srcControl=e;e._handleEvent(o);var r=sap.ui.getCore().createRenderManager();var i=e.getRenderer();i.renderTableCCnt(r,e);r.flush(t,false,false);r.destroy();var a=n.Event("AfterRendering");a.setMarked("renderRows");a.srcControl=e;e._handleEvent(a)};i.prototype.getRowContexts=function(e,t){var o=this.getTable();if(!o){return[]}return o._getRowContexts(e,t===true)};i.prototype.fireRowsUpdated=function(e){var o=this.getTable();if(!o||!o._bContextsAvailable){return}if(!this._bFiredRowsUpdatedAfterRendering){e=t.RowsUpdateReason.Render;if(!this._bListeningForFirstRowsUpdatedAfterRendering){this._bListeningForFirstRowsUpdatedAfterRendering=true;o.attachEvent("_rowsUpdated",function(){this._bFiredRowsUpdatedAfterRendering=true;this._bListeningForFirstRowsUpdatedAfterRendering=false}.bind(this))}}o._fireRowsUpdated(e)};i.prototype.disableFixedRows=function(){if(this.bFixedRowsDisabled===true){return}Object.defineProperty(this,"bFixedRowsDisabled",{value:true});function e(){r.error("This mode does not support fixed rows",this)}this.setProperty("fixedTopRowCount",0,true);this.setFixedTopRowCount=e;this.setProperty("fixedBottomRowCount",0,true);this.setFixedBottomRowCount=e};function s(e,t){var o=[];var r=e.getRows().length;for(var n=0;n<t;n++){o.push(e._getRowClone(r+n))}return o}function l(e,t){var o=e.getTable();var r=e.getRowContexts(t.length);if(!o||t.length===0){return}for(var n=0;n<t.length;n++){t[n].setRowBindingContext(r[n],o)}}a.onBeforeRendering=function(e){var t=e&&e.isMarked("renderRows");if(!t){this._bFiredRowsUpdatedAfterRendering=false}};return i});