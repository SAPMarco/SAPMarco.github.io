/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./_GroupingUtils","./_ColumnUtils","./_MenuUtils","./_BindingUtils","./_HookUtils","../library","sap/ui/base/Object","sap/ui/core/ResizeHandler","sap/ui/core/library","sap/ui/core/theming/Parameters","sap/ui/model/ChangeReason","sap/ui/thirdparty/jquery","sap/base/util/restricted/_throttle"],function(e,n,t,i,a,r,o,l,s,u,d,f,c){"use strict";var g=r.SelectionBehavior;var p=r.SelectionMode;var C=s.MessageType;var R;var v=null;var m={DATACELL:1<<1,COLUMNHEADER:1<<2,ROWHEADER:1<<3,ROWACTION:1<<4,COLUMNROWHEADER:1<<5,PSEUDO:1<<6};m.ANYCONTENTCELL=m.ROWHEADER|m.DATACELL|m.ROWACTION;m.ANYCOLUMNHEADER=m.COLUMNHEADER|m.COLUMNROWHEADER;m.ANYROWHEADER=m.ROWHEADER|m.COLUMNROWHEADER;m.ANY=m.ANYCONTENTCELL|m.ANYCOLUMNHEADER;var w={sapUiSizeCozy:48,sapUiSizeCompact:32,sapUiSizeCondensed:24,undefined:32};var S=1;var I=1;var h={sapUiSizeCozy:w.sapUiSizeCozy+I,sapUiSizeCompact:w.sapUiSizeCompact+I,sapUiSizeCondensed:w.sapUiSizeCondensed+I,undefined:w.undefined+I};var _={navigationIcon:"navigation-right-arrow",deleteIcon:"sys-cancel",resetIcon:"undo",navIndicatorWidth:3};var T={Render:"Render",VerticalScroll:"VerticalScroll",FirstVisibleRowChange:"FirstVisibleRowChange",Unbind:"Unbind",Animation:"Animation",Resize:"Resize",Zoom:"Zoom",Unknown:"Unknown"};for(var E in d){T[E]=d[E]}var b=":sapTabbable, .sapUiTableTreeIcon:not(.sapUiTableTreeIconLeaf)";function y(e){return e!=null&&e instanceof window.HTMLInputElement&&/^(text|password|search|tel|url)$/.test(e.type)}var U={Grouping:e,Column:n,Menu:t,Binding:i,Hook:a,CELLTYPE:m,BaseSize:w,BaseBorderWidth:S,RowHorizontalFrameSize:I,DefaultRowHeight:h,RowsUpdateReason:T,INTERACTIVE_ELEMENT_SELECTORS:b,ThemeParameters:_,hasRowHeader:function(n){return n.getSelectionMode()!==p.None&&n.getSelectionBehavior()!==g.RowOnly||e.isGroupMode(n)},hasSelectAll:function(e){var n=e?e.getSelectionMode():p.None;return n===p.MultiToggle&&e.getEnableSelectAll()},hasRowHighlights:function(e){if(!e){return false}var n=e.getRowSettingsTemplate();if(!n){return false}var t=n.getHighlight();return n.isBound("highlight")||t!=null&&t!==C.None},hasRowNavigationIndicators:function(e){if(!e){return false}var n=e.getRowSettingsTemplate();if(!n){return false}var t=n.getNavigated();return n.isBound("navigated")||t},hasRowActions:function(e){var n=e?e.getRowActionTemplate():null;return n!=null&&(n.isBound("visible")||n.getVisible())&&e.getRowActionCount()>0},isRowSelectionAllowed:function(e){return e.getSelectionMode()!==p.None&&(e.getSelectionBehavior()===g.Row||e.getSelectionBehavior()===g.RowOnly)},isRowSelectorSelectionAllowed:function(e){return e.getSelectionMode()!==p.None&&U.hasRowHeader(e)},areAllRowsSelected:function(e){if(!e){return false}var n=e._getSelectionPlugin();var t=n.getSelectableCount();var i=n.getSelectedCount();return t>0&&t===i},isNoDataVisible:function(e){return e.getShowNoData()&&!e._getRowMode()._bNoDataDisabled&&!U.hasData(e)||U.getVisibleColumnCount(e)===0},hasData:function(e){var n=e.getBinding("rows");var t=e._getTotalRowCount();var i=t>0;if(n&&n.providesGrandTotal){var a=n.providesGrandTotal()&&n.hasTotaledMeasures();i=a&&t>1||!a&&t>0}return i},isBusyIndicatorVisible:function(e){if(!e||!e.getDomRef()){return false}return e.getDomRef().querySelector("#"+e.getId()+"-sapUiTableGridCnt > .sapUiLocalBusyIndicator")!=null},hasPendingRequests:function(e){if(!e){return false}if(U.canUsePendingRequestsCounter(e)){return e._iPendingRequests>0}else{return e._bPendingRequest}},canUsePendingRequestsCounter:function(e){var n=e?e.getBinding("rows"):null;if(U.isA(n,"sap.ui.model.analytics.AnalyticalBinding")){return n.bUseBatchRequests}else if(U.isA(n,"sap.ui.model.TreeBinding")){return false}return true},isA:function(e,n){return o.isA(e,n)},toggleRowSelection:function(e,n,t,i){if(!e||!e.getBinding("rows")||e.getSelectionMode()===p.None||n==null){return false}var a=e._getSelectionPlugin();function r(n){if(!a.isIndexSelectable(n)){return false}e._iSourceRowIndex=n;var r=false;if(i){r=i(n,t)}else if(a.isIndexSelected(n)){if(t!==true){r=true;a.removeSelectionInterval(n,n)}}else if(t!==false){r=true;a.addSelectionInterval(n,n)}delete e._iSourceRowIndex;return r}if(typeof n==="number"){if(n<0||n>=e._getTotalRowCount()){return false}return r(n)}else{var o=f(n);var l=U.getCellInfo(o[0]);var s=U.isRowSelectionAllowed(e);if(!U.Grouping.isInGroupHeaderRow(o[0])&&(l.isOfType(U.CELLTYPE.DATACELL|U.CELLTYPE.ROWACTION)&&s||l.isOfType(U.CELLTYPE.ROWHEADER)&&U.isRowSelectorSelectionAllowed(e))){var u=e.getRows()[l.rowIndex].getIndex();return r(u)}return false}},getNoDataText:function(e){if(U.getVisibleColumnCount(e)===0){return U.getResourceText("TBL_NO_COLUMNS")}var n=e.getNoData();if(U.isA(n,"sap.ui.core.Control")){return null}else if(typeof n==="string"){return n}else{return U.getResourceText("TBL_NO_DATA")}},getVisibleColumnCount:function(e){return e._getVisibleColumns().length},getHeaderRowCount:function(e){if(e._iHeaderRowCount===undefined){if(!e.getColumnHeaderVisible()){e._iHeaderRowCount=0}else{var n=1;var t=e.getColumns();for(var i=0;i<t.length;i++){if(t[i].shouldRender()){n=Math.max(n,t[i].getMultiLabels().length)}}e._iHeaderRowCount=n}}return e._iHeaderRowCount},isVariableRowHeightEnabled:function(e){var n=e._getRowCounts();return e&&e._bVariableRowHeightEnabled&&!n.fixedTop&&!n.fixedBottom},getNonEmptyRowCount:function(e){return Math.min(e._getRowCounts().count,e._getTotalRowCount())},getFocusedItemInfo:function(e){var n=e._getItemNavigation();if(!n){return null}return{cell:n.getFocusedIndex(),columnCount:n.iColumns,cellInRow:n.getFocusedIndex()%n.iColumns,row:Math.floor(n.getFocusedIndex()/n.iColumns),cellCount:n.getItemDomRefs().length,domRef:n.getFocusedDomRef()}},getRowIndexOfFocusedCell:function(e){var n=U.getFocusedItemInfo(e);return n.row-U.getHeaderRowCount(e)},isFixedColumn:function(e,n){return n<e.getComputedFixedColumnCount()},hasFixedColumns:function(e){return e.getComputedFixedColumnCount()>0},focusItem:function(e,n,t){var i=e._getItemNavigation();if(i){i.focusItem(n,t)}},getCellInfo:function(e){var n;var t=f(e);var i;var a;var r;var o;var l;n={type:0,cell:null,rowIndex:null,columnIndex:null,columnSpan:null};if(t.hasClass("sapUiTableDataCell")){i=t.attr("data-sap-ui-colid");a=sap.ui.getCore().byId(i);n.type=U.CELLTYPE.DATACELL;n.rowIndex=parseInt(t.parent().attr("data-sap-ui-rowindex"));n.columnIndex=a.getIndex();n.columnSpan=1}else if(t.hasClass("sapUiTableHeaderDataCell")){r=/_([\d]+)/;i=t.attr("id");o=r.exec(i);l=o&&o[1]!=null?parseInt(o[1]):0;n.type=U.CELLTYPE.COLUMNHEADER;n.rowIndex=l;n.columnIndex=parseInt(t.attr("data-sap-ui-colindex"));n.columnSpan=parseInt(t.attr("colspan")||1)}else if(t.hasClass("sapUiTableRowSelectionCell")){n.type=U.CELLTYPE.ROWHEADER;n.rowIndex=parseInt(t.parent().attr("data-sap-ui-rowindex"));n.columnIndex=-1;n.columnSpan=1}else if(t.hasClass("sapUiTableRowActionCell")){n.type=U.CELLTYPE.ROWACTION;n.rowIndex=parseInt(t.parent().attr("data-sap-ui-rowindex"));n.columnIndex=-2;n.columnSpan=1}else if(t.hasClass("sapUiTableRowSelectionHeaderCell")){n.type=U.CELLTYPE.COLUMNROWHEADER;n.columnIndex=-1;n.columnSpan=1}else if(t.hasClass("sapUiTablePseudoCell")){i=t.attr("data-sap-ui-colid");a=sap.ui.getCore().byId(i);n.type=U.CELLTYPE.PSEUDO;n.rowIndex=-1;n.columnIndex=a?a.getIndex():-1;n.columnSpan=1}if(n.type!==0){n.cell=t}n.isOfType=function(e){if(e==null){return false}return(this.type&e)>0};return n},getRowColCell:function(e,n,t,i){var a=e.getRows()[n]||null;var r=i?e.getColumns():e._getVisibleColumns();var o=r[t]||null;var l=null;if(a&&o){var s=o.getMetadata().getClass();l=a.getCells().find(function(e){return o===s.ofCell(e)})||null}return{row:a,column:o,cell:l}},getCell:function(e,n,t){t=t===true;if(!e||!n){return null}var i=f(n);var a=e.getDomRef();var r=".sapUiTableCell";if(!t){r+=":not(.sapUiTablePseudoCell)"}var o=i.closest(r,a);if(o.length>0){return o}return null},getParentCell:function(e,n,t){t=t===true;var i=f(n);var a=U.getCell(e,n,t);if(!a||a[0]===i[0]){return null}else{return a}},registerResizeHandler:function(e,n,t,i,a){i=i==null?"":i;a=a===true;if(!e||typeof n!=="string"||typeof t!=="function"){return undefined}var r=e.getDomRef(i);U.deregisterResizeHandler(e,n);if(!e._mResizeHandlerIds){e._mResizeHandlerIds={}}if(a&&r){r=r.parentNode}if(r){e._mResizeHandlerIds[n]=l.register(r,t)}return e._mResizeHandlerIds[n]},deregisterResizeHandler:function(e,n){var t=[];if(!e._mResizeHandlerIds){return}if(typeof n==="string"){t.push(n)}else if(n===undefined){for(var i in e._mResizeHandlerIds){if(typeof i=="string"&&e._mResizeHandlerIds.hasOwnProperty(i)){t.push(i)}}}else if(Array.isArray(n)){t=n}for(var a=0;a<t.length;a++){var r=t[a];if(e._mResizeHandlerIds[r]){l.deregister(e._mResizeHandlerIds[r]);e._mResizeHandlerIds[r]=undefined}}},isFirstScrollableRow:function(e,n){if(isNaN(n)){var t=f(n);n=parseInt(t.add(t.parent()).filter("[data-sap-ui-rowindex]").attr("data-sap-ui-rowindex"))}return n==e._getRowCounts().fixedTop},isLastScrollableRow:function(e,n){if(isNaN(n)){var t=f(n);n=parseInt(t.add(t.parent()).filter("[data-sap-ui-rowindex]").attr("data-sap-ui-rowindex"))}var i=e._getRowCounts();return n==i.count-i.fixedBottom-1},getContentDensity:function(e){var n;var t=["sapUiSizeCondensed","sapUiSizeCompact","sapUiSizeCozy"];var i=function(e,n){if(!n[e]){return}for(var i=0;i<t.length;i++){if(n[e](t[i])){return t[i]}}};var a=e.$();if(a.length>0){n=i("hasClass",a)}else{n=i("hasStyleClass",e)}if(n){return n}var r=null;var o=e.getParent();if(o){do{n=i("hasStyleClass",o);if(n){return n}if(o.getDomRef){r=o.getDomRef()}else if(o.getRootNode){r=o.getRootNode()}if(!r&&o.getParent){o=o.getParent()}else{o=null}}while(o&&!r)}a=f(r||document.body);n=i("hasClass",a.closest("."+t.join(",.")));return n},isVariableWidth:function(e){return!e||e=="auto"||e.toString().match(/%$/)},getFirstFixedBottomRowIndex:function(e){var n=e._getRowCounts();if(!e.getBinding("rows")||n.fixedBottom===0){return-1}var t=-1;var i=e.getFirstVisibleRow();var a=e._getTotalRowCount();if(a>=n.count){t=n.count-n.fixedBottom}else{var r=a-n.fixedBottom-i;if(r>=0&&i+r<a){t=r}}return t},getResourceBundle:function(e){e=f.extend({async:false,reload:false},e);if(R&&e.reload!==true){if(e.async===true){return Promise.resolve(R)}else{return R}}var n=sap.ui.getCore().getLibraryResourceBundle("sap.ui.table",e.async===true);if(n instanceof Promise){n=n.then(function(e){R=e;return R})}else{R=n}return n},getResourceText:function(e,n){return R?R.getText(e,n):""},dynamicCall:function(e,n,t){var i=typeof e==="function"?e():e;if(!i||!n){return undefined}t=t||i;if(typeof n==="function"){n.call(t,i);return undefined}else{var a;var r=[];for(var o in n){if(typeof i[o]==="function"){a=n[o];r.push(i[o].apply(t,a))}else{r.push(undefined)}}if(r.length===1){return r[0]}else{return r}}},throttle:function(e,n,t){t=Object.assign({leading:true,asyncLeading:false,trailing:true},t);var i;var a=false;var r={};var o;var l;if(t.leading&&t.asyncLeading){o=function(){if(a){var n=Promise.resolve().then(function(){if(!n.canceled){e.apply(r.context,r.args)}i=null});n.cancel=function(){n.canceled=true};i=n}else{e.apply(this,arguments)}}}else{o=e}var s=c(o,n,{leading:t.leading,trailing:t.trailing});if(t.leading&&t.asyncLeading){var u=s.cancel;s.cancel=function(){if(i){i.cancel()}u()};l=Object.assign(function(){r={context:this,args:arguments};a=true;s.apply(this,arguments);a=false},s)}else{l=s}return l},throttleFrameWise:function(e){var n=null;var t=function(){t.cancel();n=window.requestAnimationFrame(function(n){e.apply(this,n)}.bind(this,arguments))};t.cancel=function(){window.cancelAnimationFrame(n);n=null};return t},getInteractiveElements:function(e){if(!e){return null}var n=f(e);var t=U.getCellInfo(n);if(t.isOfType(m.ANY|m.PSEUDO)){var i=n.find(b);if(i.length>0){return i}}return null},convertCSSSizeToPixel:function(e,n){var t;if(typeof e!=="string"){return null}if(e.endsWith("px")){t=parseInt(e)}else if(e.endsWith("em")||e.endsWith("rem")){t=Math.ceil(parseFloat(e)*U.getBaseFontSize())}else{return null}if(n){return t+"px"}else{return t}},getBaseFontSize:function(){if(v==null){var e=document.documentElement;if(e){v=parseInt(window.getComputedStyle(e).fontSize)}}return v==null?16:v},readThemeParameters:function(){function e(e){return U.convertCSSSizeToPixel(u.get(e))}w.undefined=e("_sap_ui_table_BaseSize");w.sapUiSizeCozy=e("_sap_ui_table_BaseSizeCozy");w.sapUiSizeCompact=e("_sap_ui_table_BaseSizeCompact");w.sapUiSizeCondensed=e("_sap_ui_table_BaseSizeCondensed");S=e("_sap_ui_table_BaseBorderWidth");I=S;h.undefined=w.undefined+I;h.sapUiSizeCozy=w.sapUiSizeCozy+I;h.sapUiSizeCompact=w.sapUiSizeCompact+I;h.sapUiSizeCondensed=w.sapUiSizeCondensed+I;_.navigationIcon=u.get("_sap_ui_table_NavigationIcon");_.deleteIcon=u.get("_sap_ui_table_DeleteIcon");_.resetIcon=u.get("_sap_ui_table_ResetIcon");_.navIndicatorWidth=e("_sap_ui_table_NavIndicatorWidth")},selectElementText:function(e){if(y(e)){e.select()}},deselectElementText:function(e){if(y(e)){e.setSelectionRange(0,0)}},addDelegate:function(e,n,t){if(e&&n){e.addDelegate(n,false,t?t:n,false)}},removeDelegate:function(e,n){if(e&&n){e.removeDelegate(n)}},createWeakMapFacade:function(){var e=new window.WeakMap;return function(n){if(!n||!(typeof n==="object")){return null}if(!e.has(n)){e.set(n,{})}return e.get(n)}}};e.TableUtils=U;n.TableUtils=U;t.TableUtils=U;i.TableUtils=U;a.TableUtils=U;return U},true);