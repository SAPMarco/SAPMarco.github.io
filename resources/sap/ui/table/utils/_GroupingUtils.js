/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/model/Sorter","sap/ui/Device","../library","sap/ui/thirdparty/jquery"],function(e,r,a,t,o){"use strict";var n={TableUtils:null,clearMode:function(e){e._mode=null},setGroupMode:function(e){e._mode="Group"},isGroupMode:function(e){return e?e._mode==="Group":false},setTreeMode:function(e){e._mode="Tree"},isTreeMode:function(e){return e?e._mode==="Tree":false},getModeCssClass:function(e){switch(e._mode){case"Group":return"sapUiTableGroupMode";case"Tree":return"sapUiTableTreeMode";default:return null}},showGroupMenuButton:function(e){return!a.system.desktop&&n.TableUtils.isA(e,"sap.ui.table.AnalyticalTable")},isInGroupHeaderRow:function(e){var r=n.TableUtils.getCellInfo(e);if(r.isOfType(n.TableUtils.CELLTYPE.ANYCONTENTCELL)){return r.cell.parent().hasClass("sapUiTableGroupHeaderRow")}return false},isInSummaryRow:function(e){var r=n.TableUtils.getCellInfo(e);if(r.isOfType(n.TableUtils.CELLTYPE.ANYCONTENTCELL)){return r.cell.parent().hasClass("sapUiTableSummaryRow")}return false},calcGroupIndent:function(e){var r=e.getLevel();var a=0;for(var t=1;t<r;t++){a+=t<=2?12:8}return a},calcTreeIndent:function(e){return(e.getLevel()-1)*17},setGroupIndent:function(e,r){var a=e.getDomRefs(true);var t=a.row;var o=a.rowHeaderPart;var n=e.getTable()._bRtlMode;var i=t.find("td.sapUiTableCellFirst > .sapUiTableCellInner");var l=o.find(".sapUiTableGroupShield");if(r<=0){o.css(n?"right":"left","");l.css("width","").css(n?"margin-right":"margin-left","");i.css(n?"padding-right":"padding-left","")}else{o.css(n?"right":"left",r+"px");l.css("width",r+"px").css(n?"margin-right":"margin-left",-1*r+"px");i.css(n?"padding-right":"padding-left",r+8+"px")}},setTreeIndent:function(e,r){var a=e.getDomRefs(true);var t=a.row;var o=e.getTable()._bRtlMode;var n=t.find(".sapUiTableTreeIcon");n.css(o?"margin-right":"margin-left",r>0?r+"px":"")},updateTableRowForGrouping:function(e){var r=e.getTable();var a=e.getDomRefs(true);var t=a.row;var o=e.getLevel();var i=e.isExpanded();var l=e.isExpandable();t.attr({"data-sap-ui-level":o}).data("sap-ui-level",o).toggleClass("sapUiTableSummaryRow",e.isSummary()).toggleClass("sapUiTableGroupHeaderRow",e.isGroupHeader());if(n.isGroupMode(r)){var s=e.getTitle();var p=n.calcGroupIndent(e);e.$("groupHeader").toggleClass("sapUiTableGroupIconOpen",l&&i).toggleClass("sapUiTableGroupIconClosed",l&&!i).attr("title",r._getShowStandardTooltips()&&s?s:null).text(s);n.setGroupIndent(e,p);t.toggleClass("sapUiTableRowIndented",p>0)}if(n.isTreeMode(r)){var u=t.find(".sapUiTableTreeIcon");u.toggleClass("sapUiTableTreeIconLeaf",!l).toggleClass("sapUiTableTreeIconNodeOpen",l&&i).toggleClass("sapUiTableTreeIconNodeClosed",l&&!i);n.setTreeIndent(e,n.calcTreeIndent(e))}if(n.showGroupMenuButton(r)){var d=a.rowHeaderPart;var g=0;var f=r.$();if(f.hasClass("sapUiTableVScr")){g+=f.find(".sapUiTableVSb").width()}var c=d.find(".sapUiTableGroupMenuButton");if(r._bRtlMode){c.css("right",f.width()-c.width()+d.position().left-g-5+"px")}else{c.css("left",f.width()-c.width()-d.position().left-g-5+"px")}}r._getAccExtension().updateAriaExpandAndLevelState(e)},cleanupTableRowForGrouping:function(e){var r=e.getTable();var a=e.getDomRefs(true);a.row.removeAttr("data-sap-ui-level");a.row.removeData("sap-ui-level");if(n.isGroupMode(r)){a.row.removeClass("sapUiTableGroupHeaderRow sapUiTableSummaryRow sapUiTableRowIndented");e.$("groupHeader").removeClass("sapUiTableGroupIconOpen","sapUiTableGroupIconClosed").attr("title","").text("");n.setGroupIndent(e,0)}if(n.isTreeMode(r)){a.row.find(".sapUiTableTreeIcon").removeClass("sapUiTableTreeIconLeaf").removeClass("sapUiTableTreeIconNodeOpen").removeClass("sapUiTableTreeIconNodeClosed");n.setTreeIndent(e,0)}r._getAccExtension().updateAriaExpandAndLevelState(e)},updateGroups:function(e){if(n.isGroupMode(e)||n.isTreeMode(e)){var r=e.getBinding("rows");if(r){e.getRows().forEach(function(e){n.updateTableRowForGrouping(e)})}else{e.getRows().forEach(function(e){n.cleanupTableRowForGrouping(e)})}}},setupExperimentalGrouping:function(a){if(!a.getEnableGrouping()){return}var t=e.prototype.getBinding.call(a,"rows");var i=sap.ui.getCore().byId(a.getGroupBy());var l=i&&i.getGrouped()&&n.TableUtils.isA(t,"sap.ui.model.ClientListBinding");if(!l||t._modified){return}t._modified=true;n.setGroupMode(a);var s=i.getSortProperty();t.sort(new r(s));var p=a._getTotalRowCount(),u=t.getContexts(0,p);var d;var g=0;for(var f=p-1;f>=0;f--){var c=u[f].getProperty(s);if(!d){d=c}if(d!==c){var T=u[f+1].getModel().getContext("/sap.ui.table.GroupInfo"+f);T.__groupInfo={oContext:u[f+1],name:d,count:g,groupHeader:true,expanded:true};u.splice(f+1,0,T);d=c;g=0}g++}var T=u[0].getModel().getContext("/sap.ui.table.GroupInfo");T.__groupInfo={oContext:u[0],name:d,count:g,groupHeader:true,expanded:true};u.splice(0,0,T);o.extend(t,{getLength:function(){return u.length},getContexts:function(e,r){return u.slice(e,e+r)}});function _(e){var r=u[e];return(r&&r.__groupInfo&&r.__groupInfo.groupHeader)===true}a._experimentalGroupingRowState=function(e){var r=e.context;if((r&&r.__groupInfo&&r.__groupInfo.groupHeader)===true){e.type=e.Type.GroupHeader}e.title=r&&r.__groupInfo&&r.__groupInfo.name+" - "+r.__groupInfo.count;e.expandable=e.type===e.Type.GroupHeader;e.expanded=e.expandable&&r.__groupInfo&&r.__groupInfo.expanded;e.level=e.expandable?1:2;e.contentHidden=e.expandable};a._experimentalGroupingExpand=function(e){var r=e.getIndex();if(_(r)&&!u[r].__groupInfo.expanded){for(var a=0;a<u[r].__childs.length;a++){u.splice(r+1+a,0,u[r].__childs[a])}delete u[r].__childs;u[r].__groupInfo.expanded=true;t._fireChange()}};a._experimentalGroupingCollapse=function(e){var r=e.getIndex();if(_(r)&&u[r].__groupInfo.expanded){u[r].__childs=u.splice(r+1,u[r].__groupInfo.count);u[r].__groupInfo.expanded=false;t._fireChange()}};var v=n.TableUtils.Hook;v.register(a,v.Keys.Row.UpdateState,a._experimentalGroupingRowState);v.register(a,v.Keys.Row.Expand,a._experimentalGroupingExpand);v.register(a,v.Keys.Row.Collapse,a._experimentalGroupingCollapse);a._mTimeouts.groupingFireBindingChange=a._mTimeouts.groupingFireBindingChange||window.setTimeout(function(){t._fireChange()},0)},resetExperimentalGrouping:function(e){var r=e.getBinding("rows");var a=n.TableUtils.Hook;if(r&&r._modified){n.clearMode(e);e.bindRows(e.getBindingInfo("rows"))}a.deregister(e,a.Keys.Row.UpdateState,e._experimentalGroupingRowState);a.deregister(e,a.Keys.Row.Expand,e._experimentalGroupingExpand);a.deregister(e,a.Keys.Row.Collapse,e._experimentalGroupingCollapse);delete e._experimentalGroupingRowState;delete e._experimentalGroupingExpand;delete e._experimentalGroupingCollapse}};return n},true);